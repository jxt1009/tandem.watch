{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://tandem.watch/./chrome-extension/src/config.js","webpack://tandem.watch/./chrome-extension/src/ui/popup.main.js"],"sourcesContent":["/**\r\n * Configuration for tandem.watch extension\r\n * \r\n * Update these values based on your deployment:\r\n * - Local development: ws://localhost:4001\r\n * - K8s deployment: ws://10.0.0.102:30401\r\n * - Production: wss://watch.toper.dev (HTTPS)\r\n */\r\n\r\nexport const CONFIG = {\r\n  // WebSocket server configuration\r\n  WS: {\r\n    // Production server (HTTPS)\r\n    URL: 'wss://watch.toper.dev/ws',\r\n    \r\n    // Kubernetes deployment (HTTP via NodePort) - for local network testing\r\n    // URL: 'ws://10.0.0.102:30401/ws',\r\n    \r\n    // Local development (HTTP)\r\n    // URL: 'ws://localhost:4001/ws',\r\n    \r\n    // Reconnection settings\r\n    MAX_RECONNECT_ATTEMPTS: 10,\r\n    RECONNECT_DELAY_MS: 3000,\r\n  },\r\n\r\n  // Feature flags\r\n  FEATURES: {\r\n    DEBUG_LOGGING: true,\r\n    AUTO_SYNC: true,\r\n    P2P_FALLBACK: true,\r\n  },\r\n\r\n  // Logging\r\n  LOG_LEVEL: 'info', // 'debug', 'info', 'warn', 'error'\r\n};\r\n\r\n// Fallback for legacy support\r\nexport const SIGNALING_SERVER_URL = CONFIG.WS.URL;\r\n","import { CONFIG } from '../config.js';\r\n\r\nlet status = { isConnected: false, roomId: null, userId: null, hasLocalStream: false };\r\n\r\n// Username management\r\nlet persistedUsername = null;\r\n\r\nasync function loadUsername() {\r\n  return new Promise((resolve) => {\r\n    if (chrome?.storage?.local) {\r\n      chrome.storage.local.get(['tandemUsername'], (result) => {\r\n        persistedUsername = result.tandemUsername || '';\r\n        if (!persistedUsername) {\r\n          persistedUsername = generateDefaultUsername();\r\n          chrome.storage.local.set({ tandemUsername: persistedUsername }, () => {});\r\n        }\r\n        // Only update label if not currently being edited\r\n        if (usernameLabel && usernameLabel.contentEditable !== 'true') {\r\n          usernameLabel.textContent = persistedUsername;\r\n        }\r\n        resolve(persistedUsername);\r\n      });\r\n      return;\r\n    }\r\n\r\n    const stored = localStorage.getItem('tandemUsername') || '';\r\n    persistedUsername = stored || generateDefaultUsername();\r\n    localStorage.setItem('tandemUsername', persistedUsername);\r\n    // Only update label if not currently being edited\r\n    if (usernameLabel && usernameLabel.contentEditable !== 'true') {\r\n      usernameLabel.textContent = persistedUsername;\r\n    }\r\n    resolve(persistedUsername);\r\n  });\r\n}\r\n\r\nfunction generateDefaultUsername() {\r\n  const suffix = Math.random().toString(36).slice(2, 6);\r\n  return `user-${suffix}`;\r\n}\r\n\r\nasync function saveUsername() {\r\n  const finalUsername = (usernameLabel?.textContent || '').trim() || generateDefaultUsername();\r\n  persistedUsername = finalUsername;\r\n  \r\n  return new Promise((resolve) => {\r\n    const onSaved = () => {\r\n      if (saveUsernameBtn) {\r\n        saveUsernameBtn.classList.add('hidden');\r\n      }\r\n      if (editUsernameBtn) {\r\n        editUsernameBtn.classList.remove('hidden');\r\n      }\r\n      if (usernameLabel) {\r\n        usernameLabel.contentEditable = 'false';\r\n        usernameLabel.textContent = finalUsername;\r\n      }\r\n      chrome.runtime.sendMessage({ type: 'UPDATE_USERNAME', username: finalUsername }, () => {});\r\n      resolve(finalUsername);\r\n    };\r\n\r\n    if (chrome?.storage?.local) {\r\n      chrome.storage.local.set({ tandemUsername: finalUsername }, onSaved);\r\n      return;\r\n    }\r\n\r\n    localStorage.setItem('tandemUsername', finalUsername);\r\n    onSaved();\r\n  });\r\n}\r\n\r\n// Cache DOM elements\r\nlet statusEl, statusText, statusControls, controlsSection, joinSection, partyInfo, statsSection, videoSection;\r\nlet startBtn, stopBtn, resetBtn, shareLinkEl, roomCodeDisplay, roomCodeInput, joinRoomBtn;\r\nlet userDisplay, localTimeEl, syncStatusEl, remoteUsersList, localVideo, remoteVideo;\r\nlet copyLinkBtn, copyCodeBtn, saveUsernameBtn, serverUrlEl;\r\nlet usernameLabel, usernameContainer, editUsernameBtn;\r\nlet toggleMicBtn, toggleVideoBtn;\r\nlet listenersBound = false;\r\n\r\nfunction initializeDOMElements() {\r\n  statusEl = document.getElementById('status');\r\n  statusText = document.getElementById('status-text');\r\n  statusControls = document.getElementById('status-controls');\r\n  controlsSection = document.getElementById('controls-section');\r\n  joinSection = document.getElementById('join-section');\r\n  partyInfo = document.getElementById('party-info');\r\n  statsSection = document.getElementById('stats-section');\r\n  videoSection = document.getElementById('video-section');\r\n  startBtn = document.getElementById('start-btn');\r\n  stopBtn = document.getElementById('stop-btn');\r\n  resetBtn = document.getElementById('reset-btn');\r\n  shareLinkEl = document.getElementById('share-link');\r\n  roomCodeDisplay = document.getElementById('room-code-display');\r\n  roomCodeInput = document.getElementById('room-code-input');\r\n  joinRoomBtn = document.getElementById('join-room-btn');\r\n  userDisplay = document.getElementById('user-display');\r\n  localTimeEl = document.getElementById('local-time');\r\n  syncStatusEl = document.getElementById('sync-status');\r\n  remoteUsersList = document.getElementById('remote-users-list');\r\n  localVideo = document.getElementById('local-video');\r\n  remoteVideo = document.getElementById('remote-video');\r\n  copyLinkBtn = document.getElementById('copy-link-btn');\r\n  copyCodeBtn = document.getElementById('copy-code-btn');\r\n  saveUsernameBtn = document.getElementById('save-username-btn');\r\n  serverUrlEl = document.getElementById('server-url');\r\n  usernameLabel = document.getElementById('user-display');\r\n  usernameContainer = document.getElementById('username-container');\r\n  editUsernameBtn = document.getElementById('edit-username-btn');\r\n  toggleMicBtn = document.getElementById('toggle-mic-btn');\r\n  toggleVideoBtn = document.getElementById('toggle-video-btn');\r\n}\r\n\r\n// Import and display server URL from config\r\ntry {\r\n  console.log('[Popup] Signaling server configured at:', CONFIG.WS.URL);\r\n} catch (err) {\r\n  console.warn('[Popup] Could not load config:', err);\r\n}\r\n\r\n// Initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    initializeDOMElements();\r\n      updateUI();\r\n    setupEventListeners();\r\n    loadUsername().then(() => {\r\n      updateStatus();\r\n      startStatusPolling();\r\n    });\r\n  });\r\n} else {\r\n  // DOM is already loaded\r\n  initializeDOMElements();\r\n    updateUI();\r\n  setupEventListeners();\r\n  loadUsername().then(() => {\r\n    updateStatus();\r\n    startStatusPolling();\r\n  });\r\n}\r\n\r\nlet lastShareLinkRoomId = null;\r\nlet lastShareLink = null;\r\nlet lastShortId = null;\r\n\r\nasync function getOrCreateShortId(roomId) {\r\n  // Query the signaling server to get or create a short ID for this room\r\n  try {\r\n    // Get the server URL from config\r\n    const config = CONFIG;\r\n    const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\r\n    \r\n    // We'll fetch this from the server - it will create the mapping\r\n    // For now, we'll request via a special endpoint (we'll add this to the server)\r\n    const response = await fetch(`${serverUrl}/api/short-id/${encodeURIComponent(roomId)}`);\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to get short ID: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    return data.shortId;\r\n  } catch (err) {\r\n    console.warn('[Popup] Could not get short ID from server, using fallback:', err);\r\n    // Fallback: generate a simple short ID client-side (not persistent)\r\n    return roomId.substring(0, 8);\r\n  }\r\n}\r\n\r\nfunction buildShareLink(roomId) {\r\n  // Build a short URL instead of full Netflix URL\r\n  return new Promise(async (resolve) => {\r\n    try {\r\n      const config = CONFIG;\r\n      const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\r\n      const shortId = await getOrCreateShortId(roomId);\r\n      const shortUrl = `${serverUrl}/room/${shortId}`;\r\n      resolve(shortUrl);\r\n    } catch (err) {\r\n      console.error('[Popup] Error building share link:', err);\r\n      resolve(`https://watch.toper.dev/room/unknown`);\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateShareLink() {\r\n  if (!shareLinkEl || !status.roomId) return;\r\n  if (status.roomId === lastShareLinkRoomId && lastShareLink) {\r\n    shareLinkEl.textContent = lastShareLink;\r\n    if (roomCodeDisplay && lastShortId) {\r\n      roomCodeDisplay.textContent = lastShortId;\r\n    }\r\n    return;\r\n  }\r\n\r\n  buildShareLink(status.roomId).then((link) => {\r\n    lastShareLinkRoomId = status.roomId;\r\n    lastShareLink = link;\r\n    shareLinkEl.textContent = link;\r\n    // Extract short ID from link\r\n    const match = link.match(/\\/room\\/([a-z0-9]+)$/i);\r\n    if (match && roomCodeDisplay) {\r\n      lastShortId = match[1];\r\n      roomCodeDisplay.textContent = lastShortId;\r\n    }\r\n  });\r\n}\r\n\r\nasync function joinRoomByCode() {\r\n  const rawInput = roomCodeInput.value.trim();\r\n  if (!rawInput) {\r\n    alert('Please enter a room code');\r\n    return;\r\n  }\r\n\r\n  const parsed = parseRoomInput(rawInput);\r\n  if (parsed.type === 'invalid' || parsed.type === 'empty') {\r\n    alert('Please enter a valid room code or share link');\r\n    return;\r\n  }\r\n\r\n  joinRoomBtn.disabled = true;\r\n  try {\r\n    let roomId = null;\r\n    if (parsed.type === 'roomId') {\r\n      roomId = parsed.roomId;\r\n    } else {\r\n      // Get the server URL from config\r\n      const config = CONFIG;\r\n      const serverUrl = config.WS.URL.replace(/^wss?:\\/\\//, 'https://').replace(/\\/ws$/, '');\r\n\r\n      roomId = await resolveRoomIdFromShortId(serverUrl, parsed.shortId);\r\n    }\r\n    \r\n    // Start party with the retrieved roomId and username\r\n    chrome.runtime.sendMessage({ type: 'START_PARTY', roomId, username: persistedUsername }, (response) => {\r\n      joinRoomBtn.disabled = false;\r\n      if (response && response.success) {\r\n        roomCodeInput.value = '';\r\n        setTimeout(updateStatus, 500);\r\n      } else {\r\n        alert('Error: ' + (response && response.error ? response.error : 'Failed to join party'));\r\n      }\r\n    });\r\n  } catch (err) {\r\n    console.error('[Popup] Error joining room:', err);\r\n    alert('Failed to join room: ' + err.message);\r\n    joinRoomBtn.disabled = false;\r\n  }\r\n}\r\n\r\nasync function resolveRoomIdFromShortId(serverUrl, shortId) {\r\n  // First try the JSON API\r\n  try {\r\n    const response = await fetch(`${serverUrl}/api/room/${encodeURIComponent(shortId)}`);\r\n    if (!response.ok) {\r\n      throw new Error('Room code not found');\r\n    }\r\n\r\n    const contentType = response.headers.get('content-type') || '';\r\n    if (!contentType.includes('application/json')) {\r\n      const text = await response.text();\r\n      // If server doesn't support /api/room, fall through to redirect-based lookup\r\n      if (!text.includes('Signaling server running')) {\r\n        throw new Error(`Unexpected response from server: ${text.slice(0, 160)}`);\r\n      }\r\n    } else {\r\n      const data = await response.json();\r\n      if (data && data.roomId) return data.roomId;\r\n    }\r\n  } catch (err) {\r\n    if (err?.message === 'Room code not found') {\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // Fallback: use /room/:shortId redirect and extract tandemRoom from Location header\r\n  const redirectResponse = await fetch(`${serverUrl}/room/${encodeURIComponent(shortId)}`, {\r\n    redirect: 'manual'\r\n  });\r\n\r\n  const location = redirectResponse.headers.get('location');\r\n  if (location) {\r\n    const match = location.match(/[?&]tandemRoom=([^&]+)/i);\r\n    if (match) {\r\n      return decodeURIComponent(match[1]);\r\n    }\r\n  }\r\n\r\n  throw new Error('Room codes are not supported on this server. Ask the host for a full Netflix link with ?tandemRoom=... or update the signaling server.');\r\n}\r\n\r\nfunction parseRoomInput(input) {\r\n  if (!input) return { type: 'empty' };\r\n  const trimmed = input.trim();\r\n\r\n  const tandemRoomMatch = trimmed.match(/[?&]tandemRoom=([^&]+)/i);\r\n  if (tandemRoomMatch) {\r\n    return { type: 'roomId', roomId: decodeURIComponent(tandemRoomMatch[1]) };\r\n  }\r\n\r\n  const roomUrlMatch = trimmed.match(/\\/room\\/([a-z0-9]+)/i);\r\n  if (roomUrlMatch) {\r\n    return { type: 'shortId', shortId: roomUrlMatch[1] };\r\n  }\r\n\r\n  const uuidMatch = trimmed.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n  if (uuidMatch) {\r\n    return { type: 'roomId', roomId: trimmed };\r\n  }\r\n\r\n  const shortIdMatch = trimmed.match(/^([a-z0-9]{3,})$/i);\r\n  if (shortIdMatch) {\r\n    return { type: 'shortId', shortId: shortIdMatch[1] };\r\n  }\r\n\r\n  return { type: 'invalid' };\r\n}\r\n\r\nfunction setupEventListeners() {\r\n  if (listenersBound) return;\r\n  listenersBound = true;\r\n\r\n  if (startBtn) {\r\n  startBtn.addEventListener('click', startParty);\r\n  }\r\n  if (stopBtn) {\r\n  stopBtn.addEventListener('click', stopParty);\r\n  }\r\n  if (resetBtn) {\r\n  resetBtn.addEventListener('click', resetParty);\r\n  }\r\n  if (copyLinkBtn) {\r\n    copyLinkBtn.addEventListener('click', copyShareLink);\r\n  }\r\n  if (copyCodeBtn) {\r\n    copyCodeBtn.addEventListener('click', () => {\r\n      if (!lastShortId) return;\r\n      navigator.clipboard.writeText(lastShortId);\r\n      copyCodeBtn.textContent = '‚úì';\r\n      setTimeout(() => { copyCodeBtn.textContent = 'Copy'; }, 1500);\r\n    });\r\n  }\r\n  if (joinRoomBtn) {\r\n    joinRoomBtn.addEventListener('click', joinRoomByCode);\r\n  }\r\n  if (roomCodeInput) {\r\n    roomCodeInput.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        joinRoomByCode();\r\n      }\r\n    });\r\n  }\r\n  if (saveUsernameBtn) {\r\n    saveUsernameBtn.addEventListener('click', saveUsername);\r\n  }\r\n  if (toggleMicBtn) {\r\n    toggleMicBtn.addEventListener('click', () => toggleMedia('audio'));\r\n  }\r\n  if (toggleVideoBtn) {\r\n    toggleVideoBtn.addEventListener('click', () => toggleMedia('video'));\r\n  }\r\n  if (editUsernameBtn) {\r\n    editUsernameBtn.addEventListener('click', () => {\r\n      if (usernameLabel) {\r\n        usernameLabel.contentEditable = 'true';\r\n        usernameLabel.focus();\r\n        // Select all text\r\n        const range = document.createRange();\r\n        range.selectNodeContents(usernameLabel);\r\n        const sel = window.getSelection();\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n      }\r\n      if (editUsernameBtn) {\r\n        editUsernameBtn.classList.add('hidden');\r\n      }\r\n      if (saveUsernameBtn) {\r\n        saveUsernameBtn.classList.remove('hidden');\r\n      }\r\n    });\r\n  }\r\n  if (saveUsernameBtn) {\r\n    saveUsernameBtn.addEventListener('click', saveUsername);\r\n  }\r\n  if (usernameLabel) {\r\n    usernameLabel.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        saveUsername();\r\n      }\r\n      if (e.key === 'Escape') {\r\n        usernameLabel.contentEditable = 'false';\r\n        usernameLabel.textContent = persistedUsername;\r\n        if (saveUsernameBtn) {\r\n          saveUsernameBtn.classList.add('hidden');\r\n        }\r\n        if (editUsernameBtn) {\r\n          editUsernameBtn.classList.remove('hidden');\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction sendToNetflixTab(message, callback) {\r\n  chrome.tabs.query({ url: 'https://www.netflix.com/*' }, (tabs) => {\r\n    if (!tabs || tabs.length === 0) {\r\n      callback && callback({ success: false, error: 'No Netflix tab found' });\r\n      return;\r\n    }\r\n    chrome.tabs.sendMessage(tabs[0].id, message, (response) => {\r\n      if (chrome.runtime.lastError) {\r\n        callback && callback({ success: false, error: chrome.runtime.lastError.message });\r\n        return;\r\n      }\r\n      callback && callback(response);\r\n    });\r\n  });\r\n}\r\n\r\nfunction updateMediaButtons(state) {\r\n  if (!state) return;\r\n  if (toggleMicBtn) {\r\n    const micEnabled = state.audioEnabled;\r\n    toggleMicBtn.textContent = micEnabled ? 'üé§' : 'üîá';\r\n    toggleMicBtn.setAttribute('aria-label', micEnabled ? 'Mute mic' : 'Unmute mic');\r\n    toggleMicBtn.setAttribute('title', micEnabled ? 'Mute mic' : 'Unmute mic');\r\n    toggleMicBtn.classList.toggle('active', !micEnabled);\r\n  }\r\n  if (toggleVideoBtn) {\r\n    const videoEnabled = state.videoEnabled;\r\n    toggleVideoBtn.textContent = videoEnabled ? 'üì∑' : 'üö´üì∑';\r\n    toggleVideoBtn.setAttribute('aria-label', videoEnabled ? 'Turn off camera' : 'Turn on camera');\r\n    toggleVideoBtn.setAttribute('title', videoEnabled ? 'Turn off camera' : 'Turn on camera');\r\n    toggleVideoBtn.classList.toggle('active', !videoEnabled);\r\n  }\r\n}\r\n\r\nfunction toggleMedia(kind) {\r\n  const type = kind === 'audio' ? 'TOGGLE_MIC' : 'TOGGLE_CAMERA';\r\n  sendToNetflixTab({ type }, (response) => {\r\n    if (!response || !response.success) {\r\n      console.warn('[Popup] Media toggle failed:', response?.error);\r\n      return;\r\n    }\r\n    updateMediaButtons(response.state);\r\n  });\r\n}\r\n\r\nfunction refreshMediaState() {\r\n  sendToNetflixTab({ type: 'GET_MEDIA_STATE' }, (response) => {\r\n    if (response && response.success) {\r\n      updateMediaButtons(response.state);\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateStatus() {\r\n  chrome.runtime.sendMessage({ type: 'GET_STATUS' }, (response) => {\r\n    if (chrome.runtime.lastError) return;\r\n    if (response) {\r\n      status = response;\r\n      updateUI();\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateUI() {\r\n  if (!statusEl || !statusText || !statusControls || !joinSection || !startBtn || !stopBtn || !resetBtn || !partyInfo || !statsSection || !videoSection || !userDisplay) {\r\n    console.warn('[Popup] UI elements not ready, skipping update');\r\n    return;\r\n  }\r\n  const { isConnected, roomId, userId } = status;\r\n  if (isConnected) {\r\n    if (statusEl) {\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.className = 'status connected status-minimal';\r\n    }\r\n    statusText.textContent = 'üü¢ Connected';\r\n    if (statusControls) {\r\n      statusControls.classList.remove('hidden');\r\n    }\r\n    if (controlsSection) {\r\n      controlsSection.classList.remove('hidden');\r\n    }\r\n    joinSection.classList.add('hidden');\r\n    startBtn.classList.add('hidden');\r\n    stopBtn.classList.remove('hidden');\r\n    resetBtn.classList.remove('hidden');\r\n    partyInfo.classList.remove('hidden');\r\n    statsSection.classList.remove('hidden');\r\n    \r\n    // Display username if set, otherwise show userId\r\n    const displayName = persistedUsername || userId;\r\n    // Only update if not currently being edited\r\n    if (userDisplay && userDisplay.contentEditable !== 'true') {\r\n      userDisplay.textContent = displayName;\r\n    }\r\n    updateShareLink();\r\n    updateStats();\r\n    refreshMediaState();\r\n  } else {\r\n    if (statusEl) {\r\n      statusEl.classList.add('hidden');\r\n      statusEl.className = 'status disconnected status-minimal';\r\n    }\r\n    statusText.textContent = 'üî¥ Disconnected';\r\n    if (statusControls) {\r\n      statusControls.classList.remove('hidden');\r\n    }\r\n    if (controlsSection) {\r\n      controlsSection.classList.remove('hidden');\r\n    }\r\n    joinSection.classList.remove('hidden');\r\n    startBtn.classList.remove('hidden');\r\n    stopBtn.classList.add('hidden');\r\n    resetBtn.classList.add('hidden');\r\n    partyInfo.classList.add('hidden');\r\n    statsSection.classList.add('hidden');\r\n    videoSection.classList.add('hidden');\r\n    localVideo.srcObject = null;\r\n    remoteVideo.srcObject = null;\r\n  }\r\n}\r\n\r\nasync function startParty() {\r\n  startBtn.disabled = true;\r\n  statusText.textContent = '‚è≥ Connecting...';\r\n  chrome.runtime.sendMessage({ type: 'START_PARTY', username: persistedUsername }, (response) => {\r\n    if (response.success) {\r\n      setTimeout(updateStatus, 500);\r\n    } else {\r\n      alert('Error: ' + response.error);\r\n      statusText.textContent = 'üî¥ Disconnected';\r\n      startBtn.disabled = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction stopParty() {\r\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\r\n    updateStatus();\r\n  });\r\n}\r\n\r\nfunction resetParty() {\r\n  resetBtn.disabled = true;\r\n  statusText.textContent = '‚ôªÔ∏è Resetting...';\r\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\r\n    chrome.runtime.sendMessage({ type: 'START_PARTY', username: persistedUsername }, (response) => {\r\n      resetBtn.disabled = false;\r\n      if (response && response.success) {\r\n        setTimeout(updateStatus, 500);\r\n      } else {\r\n        alert('Error resetting party: ' + (response && response.error ? response.error : 'Unknown error'));\r\n        statusText.textContent = 'üî¥ Disconnected';\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction copyShareLink() {\r\n  if (!status.roomId) return;\r\n  buildShareLink(status.roomId).then((link) => {\r\n    navigator.clipboard.writeText(link);\r\n    if (copyLinkBtn) {\r\n      copyLinkBtn.textContent = '‚úì';\r\n      setTimeout(() => { copyLinkBtn.textContent = 'Copy'; }, 2000);\r\n    }\r\n  });\r\n}\r\n\r\nconst formatTime = (seconds) => {\r\n  if (seconds === null || seconds === undefined) {\r\n    return '--:--';\r\n  }\r\n  const totalSeconds = Math.floor(seconds);\r\n  const minutes = Math.floor(totalSeconds / 60);\r\n  const secs = totalSeconds % 60;\r\n  return `${minutes}:${secs.toString().padStart(2, '0')}`;\r\n};\r\n\r\nfunction startStatusPolling() {\r\n  updateStatus();\r\n  setInterval(updateStatus, 2000);\r\n  // Update stats more frequently when connected\r\n  setInterval(() => {\r\n    if (status.isConnected) {\r\n      updateStats();\r\n    }\r\n  }, 1000);\r\n}\r\n\r\nasync function updateStats() {\r\n  if (!status.isConnected || !status.roomId) {\r\n    console.log('[Popup] Not connected or no room ID', { isConnected: status.isConnected, roomId: status.roomId });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Import config to get the server URL\r\n    const config = CONFIG;\r\n    \r\n    // Fetch stats from signaling server (construct HTTP URL from WebSocket URL)\r\n    const httpUrl = config.WS.URL.replace(/^wss?:\\/\\//, 'http://').replace(/\\/ws$/, '');\r\n    const statusUrl = httpUrl + '/status';\r\n    \r\n    console.log('[Popup] Fetching stats from server:', statusUrl, 'at', new Date().toISOString());\r\n    const response = await fetch(statusUrl);\r\n    if (!response.ok) {\r\n      console.error('[Popup] Failed to fetch server status:', response.status, response.statusText);\r\n      return;\r\n    }\r\n\r\n    const serverStatus = await response.json();\r\n    console.log('[Popup] Server status received at', new Date().toISOString(), ':', serverStatus);\r\n    console.log('[Popup] Looking for room:', status.roomId);\r\n\r\n    // Find our room\r\n    const room = serverStatus.rooms?.find(r => r.roomId === status.roomId);\r\n    if (!room) {\r\n      console.log('[Popup] Room not found on server. Available rooms:', serverStatus.rooms?.map(r => r.roomId));\r\n      if (syncStatusEl) {\r\n        syncStatusEl.textContent = 'Not Found';\r\n        syncStatusEl.style.color = '#ef4444';\r\n      }\r\n      return;\r\n    }\r\n    \r\n    console.log('[Popup] Room found:', room);\r\n    console.log('[Popup] Room currentTime:', room.currentTime, 'isPlaying:', room.isPlaying);\r\n    console.log('[Popup] Room users:', room.users);\r\n\r\n    // Update local time (use room's currentTime as reference)\r\n    if (localTimeEl) {\r\n      const formattedTime = formatTime(room.currentTime);\r\n      console.log('[Popup] Updating local time from', localTimeEl.textContent, 'to', formattedTime);\r\n      localTimeEl.textContent = formattedTime;\r\n    } else {\r\n      console.log('[Popup] localTimeEl not found!');\r\n    }\r\n\r\n    // Update sync status\r\n    if (syncStatusEl) {\r\n      const isPlaying = room.isPlaying ? 'Playing' : 'Paused';\r\n      console.log('[Popup] Setting sync status to:', isPlaying);\r\n      syncStatusEl.textContent = isPlaying;\r\n      syncStatusEl.style.color = room.isPlaying ? '#4ade80' : '#fbbf24';\r\n    } else {\r\n      console.log('[Popup] syncStatusEl not found!');\r\n    }\r\n\r\n    // Update user list with individual positions\r\n    if (remoteUsersList) {\r\n      const users = room.users || [];\r\n      \r\n      if (users.length === 0) {\r\n        remoteUsersList.innerHTML = '<div style=\"color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;\">No users in party</div>';\r\n      } else {\r\n        const userListHTML = users.map((user, index) => {\r\n          const timeDiff = Math.abs(user.currentTime - room.currentTime);\r\n          const isOutOfSync = timeDiff > 2; // More than 2 seconds off\r\n          const statusColor = user.isPlaying ? '#4ade80' : '#fbbf24';\r\n          const syncColor = isOutOfSync ? '#ef4444' : '#4ade80';\r\n          const isCurrentUser = user.userId === status.userId;\r\n          const bgColor = isCurrentUser ? 'rgba(167, 139, 250, 0.1)' : 'transparent';\r\n          const borderColor = isCurrentUser ? '1px solid rgba(167, 139, 250, 0.3)' : '1px solid rgba(255,255,255,0.1)';\r\n          const displayName = isCurrentUser\r\n            ? (persistedUsername || user.username || 'You')\r\n            : (user.username || `${user.userId.substring(0, 8)}...`);\r\n          \r\n          return `\r\n            <div style=\"padding: 8px; border-top: ${borderColor}; background-color: ${bgColor}; ${index === 0 ? 'border-top: none;' : ''}\">\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;\">\r\n                <div style=\"font-weight: 600; font-size: 12px; color: rgba(82, 82, 82, 0.9);\">\r\n                  ${displayName}${isCurrentUser ? ' (You)' : ''}\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${statusColor};\">\r\n                  ${user.isPlaying ? '‚ñ∂' : '‚è∏'}\r\n                </div>\r\n              </div>\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n                <div style=\"font-size: 13px; font-weight: 600; color: #a78bfa;\">\r\n                  ${formatTime(user.currentTime)}\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${syncColor}; font-weight: 600;\">\r\n                  ${isOutOfSync ? `¬±${timeDiff.toFixed(1)}s` : '‚úì synced'}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;\r\n        }).join('');\r\n        \r\n        remoteUsersList.innerHTML = `\r\n          <div style=\"font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);\">\r\n            ${users.length} user${users.length === 1 ? '' : 's'} in party\r\n          </div>\r\n          ${userListHTML}\r\n        `;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Popup] Error fetching stats:', error);\r\n  }\r\n}\r\n\r\nchrome.runtime.onMessage.addListener((request) => {\r\n  if (request.type === 'REMOTE_STREAM_RECEIVED') {\r\n    remoteVideo.srcObject = request.stream;\r\n  }\r\n});\r\n"],"names":["CONFIG","WS","URL","MAX_RECONNECT_ATTEMPTS","RECONNECT_DELAY_MS","FEATURES","DEBUG_LOGGING","AUTO_SYNC","P2P_FALLBACK","LOG_LEVEL","statusEl","statusText","statusControls","controlsSection","joinSection","partyInfo","statsSection","videoSection","startBtn","stopBtn","resetBtn","shareLinkEl","roomCodeDisplay","roomCodeInput","joinRoomBtn","userDisplay","localTimeEl","syncStatusEl","remoteUsersList","localVideo","remoteVideo","copyLinkBtn","copyCodeBtn","saveUsernameBtn","serverUrlEl","usernameLabel","usernameContainer","editUsernameBtn","toggleMicBtn","toggleVideoBtn","isConnected","roomId","userId","hasLocalStream","persistedUsername","async","loadUsername","Promise","resolve","chrome","storage","local","get","result","tandemUsername","generateDefaultUsername","set","contentEditable","textContent","stored","localStorage","getItem","setItem","Math","random","toString","slice","saveUsername","finalUsername","trim","onSaved","classList","add","remove","runtime","sendMessage","type","username","listenersBound","initializeDOMElements","document","getElementById","console","log","err","warn","readyState","addEventListener","updateUI","setupEventListeners","then","updateStatus","startStatusPolling","lastShareLinkRoomId","lastShareLink","lastShortId","buildShareLink","serverUrl","replace","shortId","response","fetch","encodeURIComponent","ok","Error","json","substring","getOrCreateShortId","error","joinRoomByCode","rawInput","value","alert","parsed","input","trimmed","tandemRoomMatch","match","decodeURIComponent","roomUrlMatch","shortIdMatch","parseRoomInput","disabled","headers","includes","data","text","message","location","redirect","resolveRoomIdFromShortId","success","setTimeout","startParty","stopParty","resetParty","copyShareLink","navigator","clipboard","writeText","e","key","toggleMedia","focus","range","createRange","selectNodeContents","sel","window","getSelection","removeAllRanges","addRange","preventDefault","sendToNetflixTab","callback","tabs","query","url","length","id","lastError","updateMediaButtons","state","micEnabled","audioEnabled","setAttribute","toggle","videoEnabled","kind","className","displayName","link","updateStats","srcObject","formatTime","seconds","totalSeconds","floor","padStart","setInterval","statusUrl","Date","toISOString","status","serverStatus","room","rooms","find","r","map","style","color","currentTime","isPlaying","users","formattedTime","innerHTML","userListHTML","user","index","timeDiff","abs","isOutOfSync","statusColor","syncColor","isCurrentUser","toFixed","join","onMessage","addListener","request","stream"],"ignoreList":[],"sourceRoot":""}