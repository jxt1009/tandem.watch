{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://tandem.watch/./chrome-extension/src/config.js","webpack://tandem.watch/./chrome-extension/src/ui/popup.main.js"],"sourcesContent":["/**\r\n * Configuration for tandem.watch extension\r\n * \r\n * Update these values based on your deployment:\r\n * - Local development: ws://localhost:4001\r\n * - K8s deployment: ws://10.0.0.102:30401\r\n * - Production: wss://watch.toper.dev (HTTPS)\r\n */\r\n\r\nexport const CONFIG = {\r\n  // WebSocket server configuration\r\n  WS: {\r\n    // Production server (HTTPS)\r\n    URL: 'wss://watch.toper.dev/ws',\r\n    \r\n    // Kubernetes deployment (HTTP via NodePort) - for local network testing\r\n    // URL: 'ws://10.0.0.102:30401/ws',\r\n    \r\n    // Local development (HTTP)\r\n    // URL: 'ws://localhost:4001/ws',\r\n    \r\n    // Reconnection settings\r\n    MAX_RECONNECT_ATTEMPTS: 10,\r\n    RECONNECT_DELAY_MS: 3000,\r\n  },\r\n\r\n  // Feature flags\r\n  FEATURES: {\r\n    DEBUG_LOGGING: true,\r\n    AUTO_SYNC: true,\r\n    P2P_FALLBACK: true,\r\n  },\r\n\r\n  // Logging\r\n  LOG_LEVEL: 'info', // 'debug', 'info', 'warn', 'error'\r\n};\r\n\r\n// Fallback for legacy support\r\nexport const SIGNALING_SERVER_URL = CONFIG.WS.URL;\r\n","import { CONFIG } from '../config.js';\r\n\r\nlet status = { isConnected: false, roomId: null, userId: null, hasLocalStream: false };\r\n\r\n// Username management\r\nlet persistedUsername = null;\r\n\r\nasync function loadUsername() {\r\n  return new Promise((resolve) => {\r\n    if (chrome?.storage?.local) {\r\n      chrome.storage.local.get(['tandemUsername'], (result) => {\r\n        persistedUsername = result.tandemUsername || '';\r\n        if (!persistedUsername) {\r\n          persistedUsername = generateDefaultUsername();\r\n          chrome.storage.local.set({ tandemUsername: persistedUsername }, () => {});\r\n        }\r\n        // Only update label if not currently being edited\r\n        if (usernameLabel && usernameLabel.contentEditable !== 'true') {\r\n          usernameLabel.textContent = persistedUsername;\r\n        }\r\n        resolve(persistedUsername);\r\n      });\r\n      return;\r\n    }\r\n\r\n    const stored = localStorage.getItem('tandemUsername') || '';\r\n    persistedUsername = stored || generateDefaultUsername();\r\n    localStorage.setItem('tandemUsername', persistedUsername);\r\n    // Only update label if not currently being edited\r\n    if (usernameLabel && usernameLabel.contentEditable !== 'true') {\r\n      usernameLabel.textContent = persistedUsername;\r\n    }\r\n    resolve(persistedUsername);\r\n  });\r\n}\r\n\r\nfunction generateDefaultUsername() {\r\n  const array = new Uint32Array(1);\r\n  crypto.getRandomValues(array);\r\n  const suffix = array[0].toString(36).slice(0, 4);\r\n  return `user-${suffix}`;\r\n}\r\n\r\nasync function saveUsername() {\r\n  const finalUsername = (usernameLabel?.textContent || '').trim() || generateDefaultUsername();\r\n  persistedUsername = finalUsername;\r\n  \r\n  return new Promise((resolve) => {\r\n    const onSaved = () => {\r\n      if (saveUsernameBtn) {\r\n        saveUsernameBtn.classList.add('hidden');\r\n      }\r\n      if (editUsernameBtn) {\r\n        editUsernameBtn.classList.remove('hidden');\r\n      }\r\n      if (usernameLabel) {\r\n        usernameLabel.contentEditable = 'false';\r\n        usernameLabel.textContent = finalUsername;\r\n      }\r\n      chrome.runtime.sendMessage({ type: 'UPDATE_USERNAME', username: finalUsername }, () => {});\r\n      resolve(finalUsername);\r\n    };\r\n\r\n    if (chrome?.storage?.local) {\r\n      chrome.storage.local.set({ tandemUsername: finalUsername }, onSaved);\r\n      return;\r\n    }\r\n\r\n    localStorage.setItem('tandemUsername', finalUsername);\r\n    onSaved();\r\n  });\r\n}\r\n\r\n// Cache DOM elements\r\nlet statusEl, statusText, statusControls, controlsSection, joinSection, partyInfo, statsSection, videoSection;\r\nlet startBtn, stopBtn, shareLinkEl, roomCodeDisplay, roomCodeInput, joinRoomBtn;\r\nlet userDisplay, localTimeEl, syncStatusEl, remoteUsersList, localVideo, remoteVideo;\r\nlet copyLinkBtn, copyCodeBtn, copyPinBtn, saveUsernameBtn, serverUrlEl;\r\nlet usernameLabel, usernameContainer, editUsernameBtn;\r\nlet toggleMicBtn, toggleVideoBtn;\r\nlet roomPinInput, roomPinDisplay;\r\nlet listenersBound = false;\r\n\r\nfunction initializeDOMElements() {\r\n  statusEl = document.getElementById('status');\r\n  statusText = document.getElementById('status-text');\r\n  statusControls = document.getElementById('status-controls');\r\n  controlsSection = document.getElementById('controls-section');\r\n  joinSection = document.getElementById('join-section');\r\n  partyInfo = document.getElementById('party-info');\r\n  statsSection = document.getElementById('stats-section');\r\n  videoSection = document.getElementById('video-section');\r\n  startBtn = document.getElementById('start-btn');\r\n  stopBtn = document.getElementById('stop-btn');\r\n  shareLinkEl = document.getElementById('share-link');\r\n  roomCodeDisplay = document.getElementById('room-code-display');\r\n  roomCodeInput = document.getElementById('room-code-input');\r\n  joinRoomBtn = document.getElementById('join-room-btn');\r\n  userDisplay = document.getElementById('user-display');\r\n  localTimeEl = document.getElementById('local-time');\r\n  syncStatusEl = document.getElementById('sync-status');\r\n  remoteUsersList = document.getElementById('remote-users-list');\r\n  localVideo = document.getElementById('local-video');\r\n  remoteVideo = document.getElementById('remote-video');\r\n  copyLinkBtn = document.getElementById('copy-link-btn');\r\n  copyCodeBtn = document.getElementById('copy-code-btn');\r\n  copyPinBtn = document.getElementById('copy-pin-btn');\r\n  saveUsernameBtn = document.getElementById('save-username-btn');\r\n  serverUrlEl = document.getElementById('server-url');\r\n  usernameLabel = document.getElementById('user-display');\r\n  usernameContainer = document.getElementById('username-container');\r\n  editUsernameBtn = document.getElementById('edit-username-btn');\r\n  toggleMicBtn = document.getElementById('toggle-mic-btn');\r\n  toggleVideoBtn = document.getElementById('toggle-video-btn');\r\n  roomPinInput = document.getElementById('room-pin-input');\r\n  roomPinDisplay = document.getElementById('room-pin-display');\r\n}\r\n\r\n// Import and display server URL from config\r\ntry {\r\n  console.log('[Popup] Signaling server configured at:', CONFIG.WS.URL);\r\n} catch (err) {\r\n  console.warn('[Popup] Could not load config:', err);\r\n}\r\n\r\n// Initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    initializeDOMElements();\r\n      updateUI();\r\n    setupEventListeners();\r\n    loadUsername().then(() => {\r\n      updateStatus();\r\n      startStatusPolling();\r\n    });\r\n  });\r\n} else {\r\n  // DOM is already loaded\r\n  initializeDOMElements();\r\n    updateUI();\r\n  setupEventListeners();\r\n  loadUsername().then(() => {\r\n    updateStatus();\r\n    startStatusPolling();\r\n  });\r\n}\r\n\r\nlet lastShareLinkRoomId = null;\r\nlet lastShareLink = null;\r\nlet lastShortId = null;\r\n\r\nasync function getOrCreateShortId(roomId) {\r\n  // Query the signaling server to get or create a short ID for this room\r\n  try {\r\n    // Get the server URL from config\r\n    const config = CONFIG;\r\n    const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\r\n    \r\n    // We'll fetch this from the server - it will create the mapping\r\n    // For now, we'll request via a special endpoint (we'll add this to the server)\r\n    const response = await fetch(`${serverUrl}/api/short-id/${encodeURIComponent(roomId)}`);\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to get short ID: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    return data.shortId;\r\n  } catch (err) {\r\n    console.warn('[Popup] Could not get short ID from server, using fallback:', err);\r\n    // Fallback: generate a simple short ID client-side (not persistent)\r\n    return roomId.substring(0, 8);\r\n  }\r\n}\r\n\r\nfunction buildShareLink(roomId, pin) {\r\n  // Build a short URL with PIN in path: /room/shortId/pin\r\n  return new Promise(async (resolve) => {\r\n    try {\r\n      const config = CONFIG;\r\n      const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\r\n      const shortId = await getOrCreateShortId(roomId);\r\n      const shortUrl = `${serverUrl}/room/${shortId}${pin ? '/' + pin : ''}`;\r\n      resolve(shortUrl);\r\n    } catch (err) {\r\n      console.error('[Popup] Error building share link:', err);\r\n      resolve(`https://watch.toper.dev/room/unknown`);\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateShareLink() {\r\n  if (!shareLinkEl || !status.roomId) return;\r\n  if (status.roomId === lastShareLinkRoomId && lastShareLink) {\r\n    shareLinkEl.textContent = lastShareLink;\r\n    if (roomCodeDisplay && lastShortId) {\r\n      roomCodeDisplay.textContent = lastShortId;\r\n    }\r\n    if (roomPinDisplay && status.pin) {\r\n      roomPinDisplay.textContent = status.pin;\r\n    }\r\n    return;\r\n  }\r\n\r\n  buildShareLink(status.roomId, status.pin).then((link) => {\r\n    lastShareLinkRoomId = status.roomId;\r\n    lastShareLink = link;\r\n    shareLinkEl.textContent = link;\r\n    // Extract short ID from link (before query params)\r\n    const match = link.match(/\\/room\\/([a-z0-9]+)/i);\r\n    if (match && roomCodeDisplay) {\r\n      lastShortId = match[1];\r\n      roomCodeDisplay.textContent = lastShortId;\r\n    }\r\n    // Display PIN\r\n    if (roomPinDisplay && status.pin) {\r\n      roomPinDisplay.textContent = status.pin;\r\n    }\r\n  });\r\n}\r\n\r\nasync function joinRoomByCode() {\r\n  const rawInput = roomCodeInput.value.trim();\r\n  if (!rawInput) {\r\n    alert('Please enter a room code');\r\n    return;\r\n  }\r\n\r\n  const parsed = parseRoomInput(rawInput);\r\n  if (parsed.type === 'invalid' || parsed.type === 'empty') {\r\n    alert('Please enter a valid room code or share link');\r\n    return;\r\n  }\r\n\r\n  joinRoomBtn.disabled = true;\r\n  try {\r\n    let roomId = null;\r\n    if (parsed.type === 'roomId') {\r\n      roomId = parsed.roomId;\r\n    } else {\r\n      // Get the server URL from config\r\n      const config = CONFIG;\r\n      const serverUrl = config.WS.URL.replace(/^wss?:\\/\\//, 'https://').replace(/\\/ws$/, '');\r\n\r\n      roomId = await resolveRoomIdFromShortId(serverUrl, parsed.shortId);\r\n    }\r\n    \r\n    // Get PIN if provided\r\n    const pin = roomPinInput?.value?.trim() || null;\r\n    \r\n    // Start party with the retrieved roomId, username, and PIN\r\n    chrome.runtime.sendMessage({ type: 'START_PARTY', roomId, username: persistedUsername, pin }, (response) => {\r\n      joinRoomBtn.disabled = false;\r\n      if (response && response.success) {\r\n        roomCodeInput.value = '';\r\n        if (roomPinInput) roomPinInput.value = '';\r\n        setTimeout(updateStatus, 500);\r\n      } else {\r\n        alert('Error: ' + (response && response.error ? response.error : 'Failed to join party'));\r\n      }\r\n    });\r\n  } catch (err) {\r\n    console.error('[Popup] Error joining room:', err);\r\n    alert('Failed to join room: ' + err.message);\r\n    joinRoomBtn.disabled = false;\r\n  }\r\n}\r\n\r\nasync function resolveRoomIdFromShortId(serverUrl, shortId) {\r\n  // First try the JSON API\r\n  try {\r\n    const response = await fetch(`${serverUrl}/api/room/${encodeURIComponent(shortId)}`);\r\n    if (!response.ok) {\r\n      throw new Error('Room code not found');\r\n    }\r\n\r\n    const contentType = response.headers.get('content-type') || '';\r\n    if (!contentType.includes('application/json')) {\r\n      const text = await response.text();\r\n      // If server doesn't support /api/room, fall through to redirect-based lookup\r\n      if (!text.includes('Signaling server running')) {\r\n        throw new Error(`Unexpected response from server: ${text.slice(0, 160)}`);\r\n      }\r\n    } else {\r\n      const data = await response.json();\r\n      if (data && data.roomId) return data.roomId;\r\n    }\r\n  } catch (err) {\r\n    if (err?.message === 'Room code not found') {\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // Fallback: use /room/:shortId redirect and extract tandemRoom from Location header\r\n  const redirectResponse = await fetch(`${serverUrl}/room/${encodeURIComponent(shortId)}`, {\r\n    redirect: 'manual'\r\n  });\r\n\r\n  const location = redirectResponse.headers.get('location');\r\n  if (location) {\r\n    const match = location.match(/[?&]tandemRoom=([^&]+)/i);\r\n    if (match) {\r\n      return decodeURIComponent(match[1]);\r\n    }\r\n  }\r\n\r\n  throw new Error('Room codes are not supported on this server. Ask the host for a full Netflix link with ?tandemRoom=... or update the signaling server.');\r\n}\r\n\r\nfunction parseRoomInput(input) {\r\n  if (!input) return { type: 'empty' };\r\n  const trimmed = input.trim();\r\n\r\n  const tandemRoomMatch = trimmed.match(/[?&]tandemRoom=([^&]+)/i);\r\n  if (tandemRoomMatch) {\r\n    return { type: 'roomId', roomId: decodeURIComponent(tandemRoomMatch[1]) };\r\n  }\r\n\r\n  const roomUrlMatch = trimmed.match(/\\/room\\/([a-z0-9]+)/i);\r\n  if (roomUrlMatch) {\r\n    return { type: 'shortId', shortId: roomUrlMatch[1] };\r\n  }\r\n\r\n  const uuidMatch = trimmed.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n  if (uuidMatch) {\r\n    return { type: 'roomId', roomId: trimmed };\r\n  }\r\n\r\n  const shortIdMatch = trimmed.match(/^([a-z0-9]{3,})$/i);\r\n  if (shortIdMatch) {\r\n    return { type: 'shortId', shortId: shortIdMatch[1] };\r\n  }\r\n\r\n  return { type: 'invalid' };\r\n}\r\n\r\nfunction setupEventListeners() {\r\n  if (listenersBound) return;\r\n  listenersBound = true;\r\n\r\n  if (startBtn) {\r\n  startBtn.addEventListener('click', startParty);\r\n  }\r\n  if (stopBtn) {\r\n  stopBtn.addEventListener('click', stopParty);\r\n  }\r\n  if (copyLinkBtn) {\r\n    copyLinkBtn.addEventListener('click', copyShareLink);\r\n  }\r\n  if (copyCodeBtn) {\r\n    copyCodeBtn.addEventListener('click', () => {\r\n      if (!lastShortId) return;\r\n      navigator.clipboard.writeText(lastShortId);\r\n      copyCodeBtn.textContent = '‚úì';\r\n      setTimeout(() => { copyCodeBtn.textContent = 'Copy'; }, 1500);\r\n    });\r\n  }\r\n  if (copyPinBtn) {\r\n    copyPinBtn.addEventListener('click', () => {\r\n      if (!status.pin) return;\r\n      navigator.clipboard.writeText(status.pin);\r\n      copyPinBtn.textContent = '‚úì';\r\n      setTimeout(() => { copyPinBtn.textContent = 'Copy'; }, 1500);\r\n    });\r\n  }\r\n  if (joinRoomBtn) {\r\n    joinRoomBtn.addEventListener('click', joinRoomByCode);\r\n  }\r\n  if (roomCodeInput) {\r\n    roomCodeInput.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        joinRoomByCode();\r\n      }\r\n    });\r\n  }\r\n  if (saveUsernameBtn) {\r\n    saveUsernameBtn.addEventListener('click', saveUsername);\r\n  }\r\n  if (toggleMicBtn) {\r\n    toggleMicBtn.addEventListener('click', () => toggleMedia('audio'));\r\n  }\r\n  if (toggleVideoBtn) {\r\n    toggleVideoBtn.addEventListener('click', () => toggleMedia('video'));\r\n  }\r\n  if (editUsernameBtn) {\r\n    editUsernameBtn.addEventListener('click', () => {\r\n      if (usernameLabel) {\r\n        usernameLabel.contentEditable = 'true';\r\n        usernameLabel.focus();\r\n        // Select all text\r\n        const range = document.createRange();\r\n        range.selectNodeContents(usernameLabel);\r\n        const sel = window.getSelection();\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n      }\r\n      if (editUsernameBtn) {\r\n        editUsernameBtn.classList.add('hidden');\r\n      }\r\n      if (saveUsernameBtn) {\r\n        saveUsernameBtn.classList.remove('hidden');\r\n      }\r\n    });\r\n  }\r\n  if (saveUsernameBtn) {\r\n    saveUsernameBtn.addEventListener('click', saveUsername);\r\n  }\r\n  if (usernameLabel) {\r\n    usernameLabel.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        saveUsername();\r\n      }\r\n      if (e.key === 'Escape') {\r\n        usernameLabel.contentEditable = 'false';\r\n        usernameLabel.textContent = persistedUsername;\r\n        if (saveUsernameBtn) {\r\n          saveUsernameBtn.classList.add('hidden');\r\n        }\r\n        if (editUsernameBtn) {\r\n          editUsernameBtn.classList.remove('hidden');\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction sendToNetflixTab(message, callback) {\r\n  chrome.tabs.query({ url: 'https://www.netflix.com/*' }, (tabs) => {\r\n    if (!tabs || tabs.length === 0) {\r\n      callback && callback({ success: false, error: 'No Netflix tab found' });\r\n      return;\r\n    }\r\n    chrome.tabs.sendMessage(tabs[0].id, message, (response) => {\r\n      if (chrome.runtime.lastError) {\r\n        callback && callback({ success: false, error: chrome.runtime.lastError.message });\r\n        return;\r\n      }\r\n      callback && callback(response);\r\n    });\r\n  });\r\n}\r\n\r\nfunction updateMediaButtons(state) {\r\n  if (!state) return;\r\n  if (toggleMicBtn) {\r\n    const micEnabled = state.audioEnabled;\r\n    toggleMicBtn.textContent = micEnabled ? 'üé§' : 'üîá';\r\n    toggleMicBtn.setAttribute('aria-label', micEnabled ? 'Mute mic' : 'Unmute mic');\r\n    toggleMicBtn.setAttribute('title', micEnabled ? 'Mute mic' : 'Unmute mic');\r\n    toggleMicBtn.classList.toggle('active', !micEnabled);\r\n  }\r\n  if (toggleVideoBtn) {\r\n    const videoEnabled = state.videoEnabled;\r\n    toggleVideoBtn.textContent = videoEnabled ? 'üì∑' : 'üö´üì∑';\r\n    toggleVideoBtn.setAttribute('aria-label', videoEnabled ? 'Turn off camera' : 'Turn on camera');\r\n    toggleVideoBtn.setAttribute('title', videoEnabled ? 'Turn off camera' : 'Turn on camera');\r\n    toggleVideoBtn.classList.toggle('active', !videoEnabled);\r\n  }\r\n}\r\n\r\nfunction toggleMedia(kind) {\r\n  const type = kind === 'audio' ? 'TOGGLE_MIC' : 'TOGGLE_CAMERA';\r\n  sendToNetflixTab({ type }, (response) => {\r\n    if (!response || !response.success) {\r\n      console.warn('[Popup] Media toggle failed:', response?.error);\r\n      return;\r\n    }\r\n    updateMediaButtons(response.state);\r\n  });\r\n}\r\n\r\nfunction refreshMediaState() {\r\n  sendToNetflixTab({ type: 'GET_MEDIA_STATE' }, (response) => {\r\n    if (response && response.success) {\r\n      updateMediaButtons(response.state);\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateStatus() {\r\n  chrome.runtime.sendMessage({ type: 'GET_STATUS' }, (response) => {\r\n    if (chrome.runtime.lastError) return;\r\n    if (response) {\r\n      status = response;\r\n      updateUI();\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateUI() {\r\n  if (!statusEl || !statusText || !statusControls || !joinSection || !startBtn || !stopBtn || !partyInfo || !statsSection || !videoSection || !userDisplay) {\r\n    console.warn('[Popup] UI elements not ready, skipping update');\r\n    return;\r\n  }\r\n  const { isConnected, roomId, userId } = status;\r\n  if (isConnected) {\r\n    if (statusEl) {\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.className = 'status connected status-minimal';\r\n    }\r\n    statusText.textContent = 'üü¢ Connected';\r\n    if (statusControls) {\r\n      statusControls.classList.remove('hidden');\r\n    }\r\n    if (controlsSection) {\r\n      controlsSection.classList.remove('hidden');\r\n    }\r\n    joinSection.classList.add('hidden');\r\n    startBtn.classList.add('hidden');\r\n    stopBtn.classList.remove('hidden');\r\n    partyInfo.classList.remove('hidden');\r\n    statsSection.classList.remove('hidden');\r\n    \r\n    // Display username if set, otherwise show userId\r\n    const displayName = persistedUsername || userId;\r\n    // Only update if not currently being edited\r\n    if (userDisplay && userDisplay.contentEditable !== 'true') {\r\n      userDisplay.textContent = displayName;\r\n    }\r\n    updateShareLink();\r\n    updateStats();\r\n    refreshMediaState();\r\n  } else {\r\n    if (statusEl) {\r\n      statusEl.classList.add('hidden');\r\n      statusEl.className = 'status disconnected status-minimal';\r\n    }\r\n    statusText.textContent = 'üî¥ Disconnected';\r\n    if (statusControls) {\r\n      statusControls.classList.remove('hidden');\r\n    }\r\n    if (controlsSection) {\r\n      controlsSection.classList.remove('hidden');\r\n    }\r\n    joinSection.classList.remove('hidden');\r\n    startBtn.classList.remove('hidden');\r\n    stopBtn.classList.add('hidden');\r\n    partyInfo.classList.add('hidden');\r\n    statsSection.classList.add('hidden');\r\n    videoSection.classList.add('hidden');\r\n    localVideo.srcObject = null;\r\n    remoteVideo.srcObject = null;\r\n  }\r\n}\r\n\r\nasync function startParty() {\r\n  startBtn.disabled = true;\r\n  statusText.textContent = '‚è≥ Connecting...';\r\n  \r\n  // Auto-generate a 6-digit PIN\r\n  const pin = Math.floor(100000 + Math.random() * 900000).toString();\r\n  \r\n  chrome.runtime.sendMessage({ type: 'START_PARTY', username: persistedUsername, pin }, (response) => {\r\n    if (response.success) {\r\n      setTimeout(updateStatus, 500);\r\n    } else {\r\n      alert('Error: ' + response.error);\r\n      statusText.textContent = 'üî¥ Disconnected';\r\n      startBtn.disabled = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction stopParty() {\r\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\r\n    updateStatus();\r\n  });\r\n}\r\n\r\nfunction copyShareLink() {\r\n  if (!status.roomId) return;\r\n  buildShareLink(status.roomId, status.pin).then((link) => {\r\n    navigator.clipboard.writeText(link);\r\n    if (copyLinkBtn) {\r\n      copyLinkBtn.textContent = '‚úì';\r\n      setTimeout(() => { copyLinkBtn.textContent = 'Copy'; }, 2000);\r\n    }\r\n  });\r\n}\r\n\r\nconst formatTime = (seconds) => {\r\n  if (seconds === null || seconds === undefined) {\r\n    return '--:--';\r\n  }\r\n  const totalSeconds = Math.floor(seconds);\r\n  const minutes = Math.floor(totalSeconds / 60);\r\n  const secs = totalSeconds % 60;\r\n  return `${minutes}:${secs.toString().padStart(2, '0')}`;\r\n};\r\n\r\nfunction startStatusPolling() {\r\n  updateStatus();\r\n  setInterval(updateStatus, 2000);\r\n  // Update stats more frequently when connected\r\n  setInterval(() => {\r\n    if (status.isConnected) {\r\n      updateStats();\r\n    }\r\n  }, 1000);\r\n}\r\n\r\nasync function updateStats() {\r\n  if (!status.isConnected || !status.roomId) {\r\n    console.log('[Popup] Not connected or no room ID', { isConnected: status.isConnected, roomId: status.roomId });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Import config to get the server URL\r\n    const config = CONFIG;\r\n    \r\n    // Fetch stats from signaling server (construct HTTP URL from WebSocket URL)\r\n    const httpUrl = config.WS.URL.replace(/^ws:\\/\\//, 'http://').replace(/^wss:\\/\\//, 'https://').replace(/\\/ws$/, '');\r\n    const statusUrl = httpUrl + '/status';\r\n    \r\n    console.log('[Popup] Fetching stats from server:', statusUrl, 'at', new Date().toISOString());\r\n    const response = await fetch(statusUrl);\r\n    if (!response.ok) {\r\n      console.error('[Popup] Failed to fetch server status:', response.status, response.statusText);\r\n      return;\r\n    }\r\n\r\n    const serverStatus = await response.json();\r\n    console.log('[Popup] Server status received at', new Date().toISOString(), ':', serverStatus);\r\n    console.log('[Popup] Looking for room:', status.roomId);\r\n\r\n    // Find our room\r\n    const room = serverStatus.rooms?.find(r => r.roomId === status.roomId);\r\n    if (!room) {\r\n      console.log('[Popup] Room not found on server. Available rooms:', serverStatus.rooms?.map(r => r.roomId));\r\n      if (syncStatusEl) {\r\n        syncStatusEl.textContent = 'Not Found';\r\n        syncStatusEl.style.color = '#ef4444';\r\n      }\r\n      return;\r\n    }\r\n    \r\n    console.log('[Popup] Room found:', room);\r\n    console.log('[Popup] Room currentTime:', room.currentTime, 'isPlaying:', room.isPlaying);\r\n    console.log('[Popup] Room users:', room.users);\r\n\r\n    // Update local time (use room's currentTime as reference)\r\n    if (localTimeEl) {\r\n      const formattedTime = formatTime(room.currentTime);\r\n      console.log('[Popup] Updating local time from', localTimeEl.textContent, 'to', formattedTime);\r\n      localTimeEl.textContent = formattedTime;\r\n    } else {\r\n      console.log('[Popup] localTimeEl not found!');\r\n    }\r\n\r\n    // Update sync status\r\n    if (syncStatusEl) {\r\n      const isPlaying = room.isPlaying ? 'Playing' : 'Paused';\r\n      console.log('[Popup] Setting sync status to:', isPlaying);\r\n      syncStatusEl.textContent = isPlaying;\r\n      syncStatusEl.style.color = room.isPlaying ? '#4ade80' : '#fbbf24';\r\n    } else {\r\n      console.log('[Popup] syncStatusEl not found!');\r\n    }\r\n\r\n    // Update user list with individual positions\r\n    if (remoteUsersList) {\r\n      const users = room.users || [];\r\n      \r\n      if (users.length === 0) {\r\n        remoteUsersList.innerHTML = '<div style=\"color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;\">No users in party</div>';\r\n      } else {\r\n        const userListHTML = users.map((user, index) => {\r\n          const timeDiff = Math.abs(user.currentTime - room.currentTime);\r\n          const isOutOfSync = timeDiff > 2; // More than 2 seconds off\r\n          const statusColor = user.isPlaying ? '#4ade80' : '#fbbf24';\r\n          const syncColor = isOutOfSync ? '#ef4444' : '#4ade80';\r\n          const isCurrentUser = user.userId === status.userId;\r\n          const bgColor = isCurrentUser ? 'rgba(167, 139, 250, 0.1)' : 'transparent';\r\n          const borderColor = isCurrentUser ? '1px solid rgba(167, 139, 250, 0.3)' : '1px solid rgba(255,255,255,0.1)';\r\n          const displayName = isCurrentUser\r\n            ? (persistedUsername || user.username || 'You')\r\n            : (user.username || `${user.userId.substring(0, 8)}...`);\r\n          \r\n          return `\r\n            <div style=\"padding: 8px; border-top: ${borderColor}; background-color: ${bgColor}; ${index === 0 ? 'border-top: none;' : ''}\">\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;\">\r\n                <div style=\"font-weight: 600; font-size: 12px; color: rgba(82, 82, 82, 0.9);\">\r\n                  ${displayName}${isCurrentUser ? ' (You)' : ''}\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${statusColor};\">\r\n                  ${user.isPlaying ? '‚ñ∂' : '‚è∏'}\r\n                </div>\r\n              </div>\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n                <div style=\"font-size: 13px; font-weight: 600; color: #a78bfa;\">\r\n                  ${formatTime(user.currentTime)}\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${syncColor}; font-weight: 600;\">\r\n                  ${isOutOfSync ? `¬±${timeDiff.toFixed(1)}s` : '‚úì synced'}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;\r\n        }).join('');\r\n        \r\n        remoteUsersList.innerHTML = `\r\n          <div style=\"font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);\">\r\n            ${users.length} user${users.length === 1 ? '' : 's'} in party\r\n          </div>\r\n          ${userListHTML}\r\n        `;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Popup] Error fetching stats:', error);\r\n  }\r\n}\r\n\r\nchrome.runtime.onMessage.addListener((request) => {\r\n  if (request.type === 'REMOTE_STREAM_RECEIVED') {\r\n    remoteVideo.srcObject = request.stream;\r\n  }\r\n});\r\n"],"names":["CONFIG","WS","URL","MAX_RECONNECT_ATTEMPTS","RECONNECT_DELAY_MS","FEATURES","DEBUG_LOGGING","AUTO_SYNC","P2P_FALLBACK","LOG_LEVEL","statusEl","statusText","statusControls","controlsSection","joinSection","partyInfo","statsSection","videoSection","startBtn","stopBtn","shareLinkEl","roomCodeDisplay","roomCodeInput","joinRoomBtn","userDisplay","localTimeEl","syncStatusEl","remoteUsersList","localVideo","remoteVideo","copyLinkBtn","copyCodeBtn","copyPinBtn","saveUsernameBtn","serverUrlEl","usernameLabel","usernameContainer","editUsernameBtn","toggleMicBtn","toggleVideoBtn","roomPinInput","roomPinDisplay","isConnected","roomId","userId","hasLocalStream","persistedUsername","async","loadUsername","Promise","resolve","chrome","storage","local","get","result","tandemUsername","generateDefaultUsername","set","contentEditable","textContent","stored","localStorage","getItem","setItem","array","Uint32Array","crypto","getRandomValues","toString","slice","saveUsername","finalUsername","trim","onSaved","classList","add","remove","runtime","sendMessage","type","username","listenersBound","initializeDOMElements","document","getElementById","console","log","err","warn","readyState","addEventListener","updateUI","setupEventListeners","then","updateStatus","startStatusPolling","lastShareLinkRoomId","lastShareLink","lastShortId","buildShareLink","pin","serverUrl","replace","shortId","response","fetch","encodeURIComponent","ok","Error","json","substring","getOrCreateShortId","error","joinRoomByCode","rawInput","value","alert","parsed","input","trimmed","tandemRoomMatch","match","decodeURIComponent","roomUrlMatch","shortIdMatch","parseRoomInput","disabled","headers","includes","data","text","message","location","redirect","resolveRoomIdFromShortId","success","setTimeout","startParty","stopParty","copyShareLink","navigator","clipboard","writeText","e","key","toggleMedia","focus","range","createRange","selectNodeContents","sel","window","getSelection","removeAllRanges","addRange","preventDefault","sendToNetflixTab","callback","tabs","query","url","length","id","lastError","updateMediaButtons","state","micEnabled","audioEnabled","setAttribute","toggle","videoEnabled","kind","className","displayName","link","updateStats","srcObject","Math","floor","random","formatTime","seconds","totalSeconds","padStart","setInterval","statusUrl","Date","toISOString","status","serverStatus","room","rooms","find","r","map","style","color","currentTime","isPlaying","users","formattedTime","innerHTML","userListHTML","user","index","timeDiff","abs","isOutOfSync","statusColor","syncColor","isCurrentUser","toFixed","join","onMessage","addListener","request","stream"],"ignoreList":[],"sourceRoot":""}