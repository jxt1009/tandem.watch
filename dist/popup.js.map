{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://tandem.watch/./chrome-extension/src/config.js","webpack://tandem.watch/./chrome-extension/src/ui/popup.main.js"],"sourcesContent":["/**\n * Configuration for tandem.watch extension\n * \n * Update these values based on your deployment:\n * - Local development: ws://localhost:4001\n * - K8s deployment: ws://10.0.0.102:30401\n * - Production: wss://watch.toper.dev (HTTPS)\n */\n\nexport const CONFIG = {\n  // WebSocket server configuration\n  WS: {\n    // Production server (HTTPS)\n    URL: 'wss://watch.toper.dev/ws',\n    \n    // Kubernetes deployment (HTTP via NodePort) - for local network testing\n    // URL: 'ws://10.0.0.102:30401/ws',\n    \n    // Local development (HTTP)\n    // URL: 'ws://localhost:4001/ws',\n    \n    // Reconnection settings\n    MAX_RECONNECT_ATTEMPTS: 10,\n    RECONNECT_DELAY_MS: 3000,\n  },\n\n  // Feature flags\n  FEATURES: {\n    DEBUG_LOGGING: true,\n    AUTO_SYNC: true,\n    P2P_FALLBACK: true,\n  },\n\n  // Logging\n  LOG_LEVEL: 'info', // 'debug', 'info', 'warn', 'error'\n};\n\n// Fallback for legacy support\nexport const SIGNALING_SERVER_URL = CONFIG.WS.URL;\n","import { CONFIG } from '../config.js';\n\nlet status = { isConnected: false, roomId: null, userId: null, hasLocalStream: false };\n\n// Username management\nlet persistedUsername = null;\n\nasync function loadUsername() {\n  return new Promise((resolve) => {\n    if (chrome?.storage?.local) {\n      chrome.storage.local.get(['tandemUsername'], (result) => {\n        persistedUsername = result.tandemUsername || '';\n        if (!persistedUsername) {\n          persistedUsername = generateDefaultUsername();\n          chrome.storage.local.set({ tandemUsername: persistedUsername }, () => {});\n        }\n        // Only update label if not currently being edited\n        if (usernameLabel && usernameLabel.contentEditable !== 'true') {\n          usernameLabel.textContent = persistedUsername;\n        }\n        resolve(persistedUsername);\n      });\n      return;\n    }\n\n    const stored = localStorage.getItem('tandemUsername') || '';\n    persistedUsername = stored || generateDefaultUsername();\n    localStorage.setItem('tandemUsername', persistedUsername);\n    // Only update label if not currently being edited\n    if (usernameLabel && usernameLabel.contentEditable !== 'true') {\n      usernameLabel.textContent = persistedUsername;\n    }\n    resolve(persistedUsername);\n  });\n}\n\nfunction generateDefaultUsername() {\n  const array = new Uint32Array(1);\n  crypto.getRandomValues(array);\n  const suffix = array[0].toString(36).slice(0, 4);\n  return `user-${suffix}`;\n}\n\nasync function saveUsername() {\n  const finalUsername = (usernameLabel?.textContent || '').trim() || generateDefaultUsername();\n  persistedUsername = finalUsername;\n  \n  return new Promise((resolve) => {\n    const onSaved = () => {\n      if (saveUsernameBtn) {\n        saveUsernameBtn.classList.add('hidden');\n      }\n      if (editUsernameBtn) {\n        editUsernameBtn.classList.remove('hidden');\n      }\n      if (usernameLabel) {\n        usernameLabel.contentEditable = 'false';\n        usernameLabel.textContent = finalUsername;\n      }\n      chrome.runtime.sendMessage({ type: 'UPDATE_USERNAME', username: finalUsername }, () => {});\n      resolve(finalUsername);\n    };\n\n    if (chrome?.storage?.local) {\n      chrome.storage.local.set({ tandemUsername: finalUsername }, onSaved);\n      return;\n    }\n\n    localStorage.setItem('tandemUsername', finalUsername);\n    onSaved();\n  });\n}\n\n// Cache DOM elements\nlet statusEl, statusText, statusControls, controlsSection, joinSection, partyInfo, statsSection, videoSection;\nlet startBtn, stopBtn, shareLinkEl, roomCodeDisplay, roomCodeInput, joinRoomBtn;\nlet userDisplay, localTimeEl, syncStatusEl, remoteUsersList, localVideo, remoteVideo;\nlet copyLinkBtn, copyCodeBtn, copyPinBtn, saveUsernameBtn, serverUrlEl;\nlet usernameLabel, usernameContainer, editUsernameBtn;\nlet toggleMicBtn, toggleVideoBtn;\nlet roomPinInput, roomPinDisplay;\nlet listenersBound = false;\n\nfunction initializeDOMElements() {\n  statusEl = document.getElementById('status');\n  statusText = document.getElementById('status-text');\n  statusControls = document.getElementById('status-controls');\n  controlsSection = document.getElementById('controls-section');\n  joinSection = document.getElementById('join-section');\n  partyInfo = document.getElementById('party-info');\n  statsSection = document.getElementById('stats-section');\n  videoSection = document.getElementById('video-section');\n  startBtn = document.getElementById('start-btn');\n  stopBtn = document.getElementById('stop-btn');\n  shareLinkEl = document.getElementById('share-link');\n  roomCodeDisplay = document.getElementById('room-code-display');\n  roomCodeInput = document.getElementById('room-code-input');\n  joinRoomBtn = document.getElementById('join-room-btn');\n  userDisplay = document.getElementById('user-display');\n  localTimeEl = document.getElementById('local-time');\n  syncStatusEl = document.getElementById('sync-status');\n  remoteUsersList = document.getElementById('remote-users-list');\n  localVideo = document.getElementById('local-video');\n  remoteVideo = document.getElementById('remote-video');\n  copyLinkBtn = document.getElementById('copy-link-btn');\n  copyCodeBtn = document.getElementById('copy-code-btn');\n  copyPinBtn = document.getElementById('copy-pin-btn');\n  saveUsernameBtn = document.getElementById('save-username-btn');\n  serverUrlEl = document.getElementById('server-url');\n  usernameLabel = document.getElementById('user-display');\n  usernameContainer = document.getElementById('username-container');\n  editUsernameBtn = document.getElementById('edit-username-btn');\n  toggleMicBtn = document.getElementById('toggle-mic-btn');\n  toggleVideoBtn = document.getElementById('toggle-video-btn');\n  roomPinInput = document.getElementById('room-pin-input');\n  roomPinDisplay = document.getElementById('room-pin-display');\n}\n\n// Import and display server URL from config\ntry {\n  console.log('[Popup] Signaling server configured at:', CONFIG.WS.URL);\n} catch (err) {\n  console.warn('[Popup] Could not load config:', err);\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    initializeDOMElements();\n      updateUI();\n    setupEventListeners();\n    loadUsername().then(() => {\n      updateStatus();\n      startStatusPolling();\n    });\n  });\n} else {\n  // DOM is already loaded\n  initializeDOMElements();\n    updateUI();\n  setupEventListeners();\n  loadUsername().then(() => {\n    updateStatus();\n    startStatusPolling();\n  });\n}\n\nlet lastShareLinkRoomId = null;\nlet lastShareLink = null;\nlet lastShortId = null;\n\nasync function getOrCreateShortId(roomId) {\n  // Query the signaling server to get or create a short ID for this room\n  try {\n    // Get the server URL from config\n    const config = CONFIG;\n    const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\n    \n    // We'll fetch this from the server - it will create the mapping\n    // For now, we'll request via a special endpoint (we'll add this to the server)\n    const response = await fetch(`${serverUrl}/api/short-id/${encodeURIComponent(roomId)}`);\n    if (!response.ok) {\n      throw new Error(`Failed to get short ID: ${response.statusText}`);\n    }\n    const data = await response.json();\n    return data.shortId;\n  } catch (err) {\n    console.warn('[Popup] Could not get short ID from server, using fallback:', err);\n    // Fallback: generate a simple short ID client-side (not persistent)\n    return roomId.substring(0, 8);\n  }\n}\n\nfunction buildShareLink(roomId, pin) {\n  // Build a short URL with PIN in path: /room/shortId/pin\n  return new Promise(async (resolve) => {\n    try {\n      const config = CONFIG;\n      const serverUrl = config.WS.URL.replace('wss://', 'https://').replace('/ws', '');\n      const shortId = await getOrCreateShortId(roomId);\n      const shortUrl = `${serverUrl}/room/${shortId}${pin ? '/' + pin : ''}`;\n      resolve(shortUrl);\n    } catch (err) {\n      console.error('[Popup] Error building share link:', err);\n      resolve(`https://watch.toper.dev/room/unknown`);\n    }\n  });\n}\n\nfunction updateShareLink() {\n  if (!shareLinkEl || !status.roomId) return;\n  if (status.roomId === lastShareLinkRoomId && lastShareLink) {\n    shareLinkEl.textContent = lastShareLink;\n    if (roomCodeDisplay && lastShortId) {\n      roomCodeDisplay.textContent = lastShortId;\n    }\n    if (roomPinDisplay && status.pin) {\n      roomPinDisplay.textContent = status.pin;\n    }\n    return;\n  }\n\n  buildShareLink(status.roomId, status.pin).then((link) => {\n    lastShareLinkRoomId = status.roomId;\n    lastShareLink = link;\n    shareLinkEl.textContent = link;\n    // Extract short ID from link (before query params)\n    const match = link.match(/\\/room\\/([a-z0-9]+)/i);\n    if (match && roomCodeDisplay) {\n      lastShortId = match[1];\n      roomCodeDisplay.textContent = lastShortId;\n    }\n    // Display PIN\n    if (roomPinDisplay && status.pin) {\n      roomPinDisplay.textContent = status.pin;\n    }\n  });\n}\n\nasync function joinRoomByCode() {\n  const rawInput = roomCodeInput.value.trim();\n  if (!rawInput) {\n    alert('Please enter a room code');\n    return;\n  }\n\n  const parsed = parseRoomInput(rawInput);\n  if (parsed.type === 'invalid' || parsed.type === 'empty') {\n    alert('Please enter a valid room code or share link');\n    return;\n  }\n\n  joinRoomBtn.disabled = true;\n  try {\n    let roomId = null;\n    if (parsed.type === 'roomId') {\n      roomId = parsed.roomId;\n    } else {\n      // Get the server URL from config\n      const config = CONFIG;\n      const serverUrl = config.WS.URL.replace(/^wss?:\\/\\//, 'https://').replace(/\\/ws$/, '');\n\n      roomId = await resolveRoomIdFromShortId(serverUrl, parsed.shortId);\n    }\n    \n    // Get PIN if provided\n    const pin = roomPinInput?.value?.trim() || null;\n    \n    // Start party with the retrieved roomId, username, and PIN\n    chrome.runtime.sendMessage({ type: 'START_PARTY', roomId, username: persistedUsername, pin }, (response) => {\n      joinRoomBtn.disabled = false;\n      if (response && response.success) {\n        roomCodeInput.value = '';\n        if (roomPinInput) roomPinInput.value = '';\n        setTimeout(updateStatus, 500);\n      } else {\n        alert('Error: ' + (response && response.error ? response.error : 'Failed to join party'));\n      }\n    });\n  } catch (err) {\n    console.error('[Popup] Error joining room:', err);\n    alert('Failed to join room: ' + err.message);\n    joinRoomBtn.disabled = false;\n  }\n}\n\nasync function resolveRoomIdFromShortId(serverUrl, shortId) {\n  // First try the JSON API\n  try {\n    const response = await fetch(`${serverUrl}/api/room/${encodeURIComponent(shortId)}`);\n    if (!response.ok) {\n      throw new Error('Room code not found');\n    }\n\n    const contentType = response.headers.get('content-type') || '';\n    if (!contentType.includes('application/json')) {\n      const text = await response.text();\n      // If server doesn't support /api/room, fall through to redirect-based lookup\n      if (!text.includes('Signaling server running')) {\n        throw new Error(`Unexpected response from server: ${text.slice(0, 160)}`);\n      }\n    } else {\n      const data = await response.json();\n      if (data && data.roomId) return data.roomId;\n    }\n  } catch (err) {\n    if (err?.message === 'Room code not found') {\n      throw err;\n    }\n  }\n\n  // Fallback: use /room/:shortId redirect and extract tandemRoom from Location header\n  const redirectResponse = await fetch(`${serverUrl}/room/${encodeURIComponent(shortId)}`, {\n    redirect: 'manual'\n  });\n\n  const location = redirectResponse.headers.get('location');\n  if (location) {\n    const match = location.match(/[?&]tandemRoom=([^&]+)/i);\n    if (match) {\n      return decodeURIComponent(match[1]);\n    }\n  }\n\n  throw new Error('Room codes are not supported on this server. Ask the host for a full Netflix link with ?tandemRoom=... or update the signaling server.');\n}\n\nfunction parseRoomInput(input) {\n  if (!input) return { type: 'empty' };\n  const trimmed = input.trim();\n\n  const tandemRoomMatch = trimmed.match(/[?&]tandemRoom=([^&]+)/i);\n  if (tandemRoomMatch) {\n    return { type: 'roomId', roomId: decodeURIComponent(tandemRoomMatch[1]) };\n  }\n\n  const roomUrlMatch = trimmed.match(/\\/room\\/([a-z0-9]+)/i);\n  if (roomUrlMatch) {\n    return { type: 'shortId', shortId: roomUrlMatch[1] };\n  }\n\n  const uuidMatch = trimmed.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\n  if (uuidMatch) {\n    return { type: 'roomId', roomId: trimmed };\n  }\n\n  const shortIdMatch = trimmed.match(/^([a-z0-9]{3,})$/i);\n  if (shortIdMatch) {\n    return { type: 'shortId', shortId: shortIdMatch[1] };\n  }\n\n  return { type: 'invalid' };\n}\n\nfunction setupEventListeners() {\n  if (listenersBound) return;\n  listenersBound = true;\n\n  if (startBtn) {\n  startBtn.addEventListener('click', startParty);\n  }\n  if (stopBtn) {\n  stopBtn.addEventListener('click', stopParty);\n  }\n  if (copyLinkBtn) {\n    copyLinkBtn.addEventListener('click', copyShareLink);\n  }\n  if (copyCodeBtn) {\n    copyCodeBtn.addEventListener('click', () => {\n      if (!lastShortId) return;\n      navigator.clipboard.writeText(lastShortId);\n      copyCodeBtn.textContent = '‚úì';\n      setTimeout(() => { copyCodeBtn.textContent = 'Copy'; }, 1500);\n    });\n  }\n  if (copyPinBtn) {\n    copyPinBtn.addEventListener('click', () => {\n      if (!status.pin) return;\n      navigator.clipboard.writeText(status.pin);\n      copyPinBtn.textContent = '‚úì';\n      setTimeout(() => { copyPinBtn.textContent = 'Copy'; }, 1500);\n    });\n  }\n  if (joinRoomBtn) {\n    joinRoomBtn.addEventListener('click', joinRoomByCode);\n  }\n  if (roomCodeInput) {\n    roomCodeInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        joinRoomByCode();\n      }\n    });\n  }\n  if (saveUsernameBtn) {\n    saveUsernameBtn.addEventListener('click', saveUsername);\n  }\n  if (toggleMicBtn) {\n    toggleMicBtn.addEventListener('click', () => toggleMedia('audio'));\n  }\n  if (toggleVideoBtn) {\n    toggleVideoBtn.addEventListener('click', () => toggleMedia('video'));\n  }\n  if (editUsernameBtn) {\n    editUsernameBtn.addEventListener('click', () => {\n      if (usernameLabel) {\n        usernameLabel.contentEditable = 'true';\n        usernameLabel.focus();\n        // Select all text\n        const range = document.createRange();\n        range.selectNodeContents(usernameLabel);\n        const sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n      }\n      if (editUsernameBtn) {\n        editUsernameBtn.classList.add('hidden');\n      }\n      if (saveUsernameBtn) {\n        saveUsernameBtn.classList.remove('hidden');\n      }\n    });\n  }\n  if (saveUsernameBtn) {\n    saveUsernameBtn.addEventListener('click', saveUsername);\n  }\n  if (usernameLabel) {\n    usernameLabel.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        saveUsername();\n      }\n      if (e.key === 'Escape') {\n        usernameLabel.contentEditable = 'false';\n        usernameLabel.textContent = persistedUsername;\n        if (saveUsernameBtn) {\n          saveUsernameBtn.classList.add('hidden');\n        }\n        if (editUsernameBtn) {\n          editUsernameBtn.classList.remove('hidden');\n        }\n      }\n    });\n  }\n}\n\nfunction sendToNetflixTab(message, callback) {\n  chrome.tabs.query({ url: 'https://www.netflix.com/*' }, (tabs) => {\n    if (!tabs || tabs.length === 0) {\n      callback && callback({ success: false, error: 'No Netflix tab found' });\n      return;\n    }\n    chrome.tabs.sendMessage(tabs[0].id, message, (response) => {\n      if (chrome.runtime.lastError) {\n        callback && callback({ success: false, error: chrome.runtime.lastError.message });\n        return;\n      }\n      callback && callback(response);\n    });\n  });\n}\n\nfunction updateMediaButtons(state) {\n  if (!state) return;\n  if (toggleMicBtn) {\n    const micEnabled = state.audioEnabled;\n    toggleMicBtn.textContent = micEnabled ? 'üé§' : 'üîá';\n    toggleMicBtn.setAttribute('aria-label', micEnabled ? 'Mute mic' : 'Unmute mic');\n    toggleMicBtn.setAttribute('title', micEnabled ? 'Mute mic' : 'Unmute mic');\n    toggleMicBtn.classList.toggle('active', !micEnabled);\n  }\n  if (toggleVideoBtn) {\n    const videoEnabled = state.videoEnabled;\n    toggleVideoBtn.textContent = videoEnabled ? 'üì∑' : 'üö´üì∑';\n    toggleVideoBtn.setAttribute('aria-label', videoEnabled ? 'Turn off camera' : 'Turn on camera');\n    toggleVideoBtn.setAttribute('title', videoEnabled ? 'Turn off camera' : 'Turn on camera');\n    toggleVideoBtn.classList.toggle('active', !videoEnabled);\n  }\n}\n\nfunction toggleMedia(kind) {\n  const type = kind === 'audio' ? 'TOGGLE_MIC' : 'TOGGLE_CAMERA';\n  sendToNetflixTab({ type }, (response) => {\n    if (!response || !response.success) {\n      console.warn('[Popup] Media toggle failed:', response?.error);\n      return;\n    }\n    updateMediaButtons(response.state);\n  });\n}\n\nfunction refreshMediaState() {\n  sendToNetflixTab({ type: 'GET_MEDIA_STATE' }, (response) => {\n    if (response && response.success) {\n      updateMediaButtons(response.state);\n    }\n  });\n}\n\nfunction updateStatus() {\n  chrome.runtime.sendMessage({ type: 'GET_STATUS' }, (response) => {\n    if (chrome.runtime.lastError) return;\n    if (response) {\n      status = response;\n      updateUI();\n    }\n  });\n}\n\nfunction updateUI() {\n  if (!statusEl || !statusText || !statusControls || !joinSection || !startBtn || !stopBtn || !partyInfo || !statsSection || !videoSection || !userDisplay) {\n    console.warn('[Popup] UI elements not ready, skipping update');\n    return;\n  }\n  const { isConnected, roomId, userId } = status;\n  if (isConnected) {\n    if (statusEl) {\n      statusEl.classList.remove('hidden');\n      statusEl.className = 'status connected status-minimal';\n    }\n    statusText.textContent = 'üü¢ Connected';\n    if (statusControls) {\n      statusControls.classList.remove('hidden');\n    }\n    if (controlsSection) {\n      controlsSection.classList.remove('hidden');\n    }\n    joinSection.classList.add('hidden');\n    startBtn.classList.add('hidden');\n    stopBtn.classList.remove('hidden');\n    partyInfo.classList.remove('hidden');\n    statsSection.classList.remove('hidden');\n    \n    // Display username if set, otherwise show userId\n    const displayName = persistedUsername || userId;\n    // Only update if not currently being edited\n    if (userDisplay && userDisplay.contentEditable !== 'true') {\n      userDisplay.textContent = displayName;\n    }\n    updateShareLink();\n    updateStats();\n    refreshMediaState();\n  } else {\n    if (statusEl) {\n      statusEl.classList.add('hidden');\n      statusEl.className = 'status disconnected status-minimal';\n    }\n    statusText.textContent = 'üî¥ Disconnected';\n    if (statusControls) {\n      statusControls.classList.remove('hidden');\n    }\n    if (controlsSection) {\n      controlsSection.classList.remove('hidden');\n    }\n    joinSection.classList.remove('hidden');\n    startBtn.classList.remove('hidden');\n    stopBtn.classList.add('hidden');\n    partyInfo.classList.add('hidden');\n    statsSection.classList.add('hidden');\n    videoSection.classList.add('hidden');\n    localVideo.srcObject = null;\n    remoteVideo.srcObject = null;\n  }\n}\n\nasync function startParty() {\n  startBtn.disabled = true;\n  statusText.textContent = '‚è≥ Connecting...';\n  \n  // Auto-generate a 6-digit PIN\n  const pin = Math.floor(100000 + Math.random() * 900000).toString();\n  \n  chrome.runtime.sendMessage({ type: 'START_PARTY', username: persistedUsername, pin }, (response) => {\n    if (response.success) {\n      setTimeout(updateStatus, 500);\n    } else {\n      alert('Error: ' + response.error);\n      statusText.textContent = 'üî¥ Disconnected';\n      startBtn.disabled = false;\n    }\n  });\n}\n\nfunction stopParty() {\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\n    updateStatus();\n  });\n}\n\nfunction copyShareLink() {\n  if (!status.roomId) return;\n  buildShareLink(status.roomId, status.pin).then((link) => {\n    navigator.clipboard.writeText(link);\n    if (copyLinkBtn) {\n      copyLinkBtn.textContent = '‚úì';\n      setTimeout(() => { copyLinkBtn.textContent = 'Copy'; }, 2000);\n    }\n  });\n}\n\nconst formatTime = (seconds) => {\n  if (seconds === null || seconds === undefined) {\n    return '--:--';\n  }\n  const totalSeconds = Math.floor(seconds);\n  const minutes = Math.floor(totalSeconds / 60);\n  const secs = totalSeconds % 60;\n  return `${minutes}:${secs.toString().padStart(2, '0')}`;\n};\n\nfunction startStatusPolling() {\n  updateStatus();\n  setInterval(updateStatus, 2000);\n  // Update stats more frequently when connected\n  setInterval(() => {\n    if (status.isConnected) {\n      updateStats();\n    }\n  }, 1000);\n}\n\nasync function updateStats() {\n  if (!status.isConnected || !status.roomId) {\n    console.log('[Popup] Not connected or no room ID', { isConnected: status.isConnected, roomId: status.roomId });\n    return;\n  }\n\n  try {\n    // Import config to get the server URL\n    const config = CONFIG;\n    \n    // Fetch stats from signaling server (construct HTTP URL from WebSocket URL)\n    const httpUrl = config.WS.URL.replace(/^ws:\\/\\//, 'http://').replace(/^wss:\\/\\//, 'https://').replace(/\\/ws$/, '');\n    const statusUrl = httpUrl + '/status';\n    \n    console.log('[Popup] Fetching stats from server:', statusUrl, 'at', new Date().toISOString());\n    const response = await fetch(statusUrl);\n    if (!response.ok) {\n      console.error('[Popup] Failed to fetch server status:', response.status, response.statusText);\n      return;\n    }\n\n    const serverStatus = await response.json();\n    console.log('[Popup] Server status received at', new Date().toISOString(), ':', serverStatus);\n    console.log('[Popup] Looking for room:', status.roomId);\n\n    // Find our room\n    const room = serverStatus.rooms?.find(r => r.roomId === status.roomId);\n    if (!room) {\n      console.log('[Popup] Room not found on server. Available rooms:', serverStatus.rooms?.map(r => r.roomId));\n      if (syncStatusEl) {\n        syncStatusEl.textContent = 'Not Found';\n        syncStatusEl.style.color = '#ef4444';\n      }\n      return;\n    }\n    \n    console.log('[Popup] Room found:', room);\n    console.log('[Popup] Room currentTime:', room.currentTime, 'isPlaying:', room.isPlaying);\n    console.log('[Popup] Room users:', room.users);\n\n    // Update local time (use room's currentTime as reference)\n    if (localTimeEl) {\n      const formattedTime = formatTime(room.currentTime);\n      console.log('[Popup] Updating local time from', localTimeEl.textContent, 'to', formattedTime);\n      localTimeEl.textContent = formattedTime;\n    } else {\n      console.log('[Popup] localTimeEl not found!');\n    }\n\n    // Update sync status\n    if (syncStatusEl) {\n      const isPlaying = room.isPlaying ? 'Playing' : 'Paused';\n      console.log('[Popup] Setting sync status to:', isPlaying);\n      syncStatusEl.textContent = isPlaying;\n      syncStatusEl.style.color = room.isPlaying ? '#4ade80' : '#fbbf24';\n    } else {\n      console.log('[Popup] syncStatusEl not found!');\n    }\n\n    // Update user list with individual positions\n    if (remoteUsersList) {\n      const users = room.users || [];\n      \n      if (users.length === 0) {\n        remoteUsersList.innerHTML = '<div style=\"color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;\">No users in party</div>';\n      } else {\n        const userListHTML = users.map((user, index) => {\n          const timeDiff = Math.abs(user.currentTime - room.currentTime);\n          const isOutOfSync = timeDiff > 2; // More than 2 seconds off\n          const statusColor = user.isPlaying ? '#4ade80' : '#fbbf24';\n          const syncColor = isOutOfSync ? '#ef4444' : '#4ade80';\n          const isCurrentUser = user.userId === status.userId;\n          const bgColor = isCurrentUser ? 'rgba(167, 139, 250, 0.1)' : 'transparent';\n          const borderColor = isCurrentUser ? '1px solid rgba(167, 139, 250, 0.3)' : '1px solid rgba(255,255,255,0.1)';\n          const displayName = isCurrentUser\n            ? (persistedUsername || user.username || 'You')\n            : (user.username || `${user.userId.substring(0, 8)}...`);\n          \n          return `\n            <div style=\"padding: 8px; border-top: ${borderColor}; background-color: ${bgColor}; ${index === 0 ? 'border-top: none;' : ''}\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;\">\n                <div style=\"font-weight: 600; font-size: 12px; color: rgba(82, 82, 82, 0.9);\">\n                  ${displayName}${isCurrentUser ? ' (You)' : ''}\n                </div>\n                <div style=\"font-size: 10px; color: ${statusColor};\">\n                  ${user.isPlaying ? '‚ñ∂' : '‚è∏'}\n                </div>\n              </div>\n              <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <div style=\"font-size: 13px; font-weight: 600; color: #a78bfa;\">\n                  ${formatTime(user.currentTime)}\n                </div>\n                <div style=\"font-size: 10px; color: ${syncColor}; font-weight: 600;\">\n                  ${isOutOfSync ? `¬±${timeDiff.toFixed(1)}s` : '‚úì synced'}\n                </div>\n              </div>\n            </div>\n          `;\n        }).join('');\n        \n        remoteUsersList.innerHTML = `\n          <div style=\"font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);\">\n            ${users.length} user${users.length === 1 ? '' : 's'} in party\n          </div>\n          ${userListHTML}\n        `;\n      }\n    }\n  } catch (error) {\n    console.error('[Popup] Error fetching stats:', error);\n  }\n}\n\nchrome.runtime.onMessage.addListener((request) => {\n  if (request.type === 'REMOTE_STREAM_RECEIVED') {\n    remoteVideo.srcObject = request.stream;\n  }\n});\n"],"names":["CONFIG","WS","URL","MAX_RECONNECT_ATTEMPTS","RECONNECT_DELAY_MS","FEATURES","DEBUG_LOGGING","AUTO_SYNC","P2P_FALLBACK","LOG_LEVEL","statusEl","statusText","statusControls","controlsSection","joinSection","partyInfo","statsSection","videoSection","startBtn","stopBtn","shareLinkEl","roomCodeDisplay","roomCodeInput","joinRoomBtn","userDisplay","localTimeEl","syncStatusEl","remoteUsersList","localVideo","remoteVideo","copyLinkBtn","copyCodeBtn","copyPinBtn","saveUsernameBtn","serverUrlEl","usernameLabel","usernameContainer","editUsernameBtn","toggleMicBtn","toggleVideoBtn","roomPinInput","roomPinDisplay","isConnected","roomId","userId","hasLocalStream","persistedUsername","async","loadUsername","Promise","resolve","chrome","storage","local","get","result","tandemUsername","generateDefaultUsername","set","contentEditable","textContent","stored","localStorage","getItem","setItem","array","Uint32Array","crypto","getRandomValues","toString","slice","saveUsername","finalUsername","trim","onSaved","classList","add","remove","runtime","sendMessage","type","username","listenersBound","initializeDOMElements","document","getElementById","console","log","err","warn","readyState","addEventListener","updateUI","setupEventListeners","then","updateStatus","startStatusPolling","lastShareLinkRoomId","lastShareLink","lastShortId","buildShareLink","pin","serverUrl","replace","shortId","response","fetch","encodeURIComponent","ok","Error","json","substring","getOrCreateShortId","error","joinRoomByCode","rawInput","value","alert","parsed","input","trimmed","tandemRoomMatch","match","decodeURIComponent","roomUrlMatch","shortIdMatch","parseRoomInput","disabled","headers","includes","data","text","message","location","redirect","resolveRoomIdFromShortId","success","setTimeout","startParty","stopParty","copyShareLink","navigator","clipboard","writeText","e","key","toggleMedia","focus","range","createRange","selectNodeContents","sel","window","getSelection","removeAllRanges","addRange","preventDefault","sendToNetflixTab","callback","tabs","query","url","length","id","lastError","updateMediaButtons","state","micEnabled","audioEnabled","setAttribute","toggle","videoEnabled","kind","className","displayName","link","updateStats","srcObject","Math","floor","random","formatTime","seconds","totalSeconds","padStart","setInterval","statusUrl","Date","toISOString","status","serverStatus","room","rooms","find","r","map","style","color","currentTime","isPlaying","users","formattedTime","innerHTML","userListHTML","user","index","timeDiff","abs","isOutOfSync","statusColor","syncColor","isCurrentUser","toFixed","join","onMessage","addListener","request","stream"],"ignoreList":[],"sourceRoot":""}