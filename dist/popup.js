(()=>{var e,t,o={},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return o[e](s,s.exports,r),s.exports}r.m=o,r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,o)=>(r.f[o](e,t),t),[])),r.u=e=>e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="tandem.watch:",r.l=(o,n,s,i)=>{if(e[o])e[o].push(n);else{var d,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),a=0;a<l.length;a++){var u=l[a];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+s){d=u;break}}d||(c=!0,(d=document.createElement("script")).charset="utf-8",r.nc&&d.setAttribute("nonce",r.nc),d.setAttribute("data-webpack",t+s),d.src=o),e[o]=[n];var m=(t,n)=>{d.onerror=d.onload=null,clearTimeout(p);var r=e[o];if(delete e[o],d.parentNode&&d.parentNode.removeChild(d),r&&r.forEach(e=>e(n)),t)return t(n)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),c&&document.head.appendChild(d)}},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={887:0};r.f.j=(t,o)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var s=new Promise((o,r)=>n=e[t]=[o,r]);o.push(n[2]=s);var i=r.p+r.u(t),d=new Error;r.l(i,o=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;d.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",d.name="ChunkLoadError",d.type=s,d.request=i,n[1](d)}},"chunk-"+t,t)}};var t=(t,o)=>{var n,s,[i,d,c]=o,l=0;if(i.some(t=>0!==e[t])){for(n in d)r.o(d,n)&&(r.m[n]=d[n]);c&&c(r)}for(t&&t(o);l<i.length;l++)s=i[l],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},o=self.webpackChunktandem_watch=self.webpackChunktandem_watch||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();let s={isConnected:!1,roomId:null,userId:null,hasLocalStream:!1};const i=document.getElementById("status"),d=document.getElementById("status-text"),c=document.getElementById("controls-section"),l=document.getElementById("party-info"),a=document.getElementById("stats-section"),u=document.getElementById("video-section"),m=document.getElementById("start-btn"),p=document.getElementById("stop-btn"),g=document.getElementById("reset-btn"),f=document.getElementById("room-input"),y=document.getElementById("room-display"),v=document.getElementById("user-display"),h=document.getElementById("local-time"),b=document.getElementById("sync-status"),E=document.getElementById("remote-users-list"),I=document.getElementById("local-video"),P=document.getElementById("remote-video"),T=document.getElementById("copy-room-btn"),x=document.getElementById("server-url");function C(){chrome.runtime.sendMessage({type:"GET_STATUS"},e=>{chrome.runtime.lastError||e&&(s=e,function(){const{isConnected:e,roomId:t,userId:o}=s;e?(i.className="status connected",d.textContent="üü¢ Connected",c.classList.remove("hidden"),m.classList.add("hidden"),p.classList.remove("hidden"),g.classList.remove("hidden"),l.classList.remove("hidden"),a.classList.remove("hidden"),y.textContent=t,v.textContent=o,w()):(i.className="status disconnected",d.textContent="üî¥ Disconnected",c.classList.remove("hidden"),m.classList.remove("hidden"),p.classList.add("hidden"),g.classList.add("hidden"),l.classList.add("hidden"),a.classList.add("hidden"),u.classList.add("hidden"),I.srcObject=null,P.srcObject=null)}())})}async function w(){if(s.isConnected&&s.roomId)try{const{CONFIG:e}=await r.e(23).then(r.bind(r,23)),t=e.WS.URL.replace(/^wss?:\/\//,"http://").replace(/\/ws$/,"")+"/status";console.log("[Popup] Fetching stats from server:",t);const o=await fetch(t);if(!o.ok)return void console.error("[Popup] Failed to fetch server status:",o.status,o.statusText);const n=await o.json();console.log("[Popup] Server status received:",n),console.log("[Popup] Looking for room:",s.roomId);const i=n.rooms?.find(e=>e.roomId===s.roomId);if(!i)return console.log("[Popup] Room not found on server. Available rooms:",n.rooms?.map(e=>e.roomId)),void(b&&(b.textContent="Not Found",b.style.color="#ef4444"));console.log("[Popup] Room found:",i),console.log("[Popup] Room currentTime:",i.currentTime,"isPlaying:",i.isPlaying),console.log("[Popup] Room users:",i.users);const d=e=>{if(console.log("[Popup] Formatting time:",e,"type:",typeof e),null==e)return console.log("[Popup] Time is null/undefined, returning --:--"),"--:--";const t=Math.floor(e),o=`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`;return console.log("[Popup] Formatted time:",o),o};if(h){const e=d(i.currentTime);console.log("[Popup] Setting localTimeEl.textContent to:",e),h.textContent=e}else console.log("[Popup] localTimeEl not found!");if(b){const e=i.isPlaying?"Playing":"Paused";console.log("[Popup] Setting sync status to:",e),b.textContent=e,b.style.color=i.isPlaying?"#4ade80":"#fbbf24"}else console.log("[Popup] syncStatusEl not found!");if(E){const e=i.users||[];if(0===e.length)E.innerHTML='<div style="color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;">No users in party</div>';else{const t=e.map((e,t)=>{const o=Math.abs(e.currentTime-i.currentTime),n=o>2,r=e.isPlaying?"#4ade80":"#fbbf24",c=n?"#ef4444":"#4ade80",l=e.userId===s.userId;return`\n            <div style="padding: 8px; border-top: ${l?"1px solid rgba(167, 139, 250, 0.3)":"1px solid rgba(255,255,255,0.1)"}; background-color: ${l?"rgba(167, 139, 250, 0.1)":"transparent"}; ${0===t?"border-top: none;":""}">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">\n                <div style="font-weight: 600; font-size: 12px; color: rgba(255,255,255,0.9);">\n                  ${e.userId.substring(0,8)}...${l?" (You)":""}\n                </div>\n                <div style="font-size: 10px; color: ${r};">\n                  ${e.isPlaying?"‚ñ∂":"‚è∏"}\n                </div>\n              </div>\n              <div style="display: flex; justify-content: space-between; align-items: center;">\n                <div style="font-size: 13px; font-weight: 600; color: #a78bfa;">\n                  ${d(e.currentTime)}\n                </div>\n                <div style="font-size: 10px; color: ${c}; font-weight: 600;">\n                  ${n?`¬±${o.toFixed(1)}s`:"‚úì synced"}\n                </div>\n              </div>\n            </div>\n          `}).join("");E.innerHTML=`\n          <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);">\n            ${e.length} user${1===e.length?"":"s"} in party\n          </div>\n          ${t}\n        `}}}catch(e){console.error("[Popup] Error fetching stats:",e)}else console.log("[Popup] Not connected or no room ID",{isConnected:s.isConnected,roomId:s.roomId})}r.e(23).then(r.bind(r,23)).then(({CONFIG:e})=>{x&&(x.textContent=e.WS.URL),console.log("[Popup] Signaling server configured at:",e.WS.URL)}).catch(e=>{console.warn("[Popup] Could not load config:",e)}),C(),m.addEventListener("click",async function(){const e=f.value.trim()||void 0;m.disabled=!0,d.textContent="‚è≥ Connecting...",chrome.runtime.sendMessage({type:"START_PARTY",roomId:e},e=>{e.success?setTimeout(C,500):(alert("Error: "+e.error),d.textContent="üî¥ Disconnected",m.disabled=!1)})}),p.addEventListener("click",function(){chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{f.value="",C()})}),g.addEventListener("click",function(){const e=f.value.trim()||s.roomId||void 0;g.disabled=!0,d.textContent="‚ôªÔ∏è Resetting...",chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{chrome.runtime.sendMessage({type:"START_PARTY",roomId:e},e=>{g.disabled=!1,e&&e.success?setTimeout(C,500):(alert("Error resetting party: "+(e&&e.error?e.error:"Unknown error")),d.textContent="üî¥ Disconnected")})})}),T.addEventListener("click",function(){s.roomId&&(navigator.clipboard.writeText(s.roomId),T.textContent="‚úì",setTimeout(()=>{T.textContent="üìã"},2e3))}),C(),setInterval(C,2e3),setInterval(()=>{s.isConnected&&w()},1e3),chrome.runtime.onMessage.addListener(e=>{"REMOTE_STREAM_RECEIVED"===e.type&&(P.srcObject=e.stream)})})();
//# sourceMappingURL=popup.js.map