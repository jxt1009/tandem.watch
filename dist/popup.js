(()=>{let e={isConnected:!1,roomId:null,userId:null,hasLocalStream:!1};const t=document.getElementById("status"),o=document.getElementById("status-text"),n=document.getElementById("controls-section"),s=document.getElementById("party-info"),i=document.getElementById("stats-section"),d=document.getElementById("video-section"),r=document.getElementById("start-btn"),c=document.getElementById("stop-btn"),l=document.getElementById("reset-btn"),a=document.getElementById("room-input"),m=document.getElementById("room-display"),u=document.getElementById("user-display"),g=document.getElementById("local-time"),p=document.getElementById("sync-status"),y=document.getElementById("remote-users-list"),f=document.getElementById("local-video"),v=document.getElementById("remote-video"),I=document.getElementById("copy-room-btn");function h(){chrome.runtime.sendMessage({type:"GET_STATUS"},a=>{chrome.runtime.lastError||a&&(e=a,function(){const{isConnected:a,roomId:g,userId:p}=e;a?(t.className="status connected",o.textContent="üü¢ Connected",n.classList.remove("hidden"),r.classList.add("hidden"),c.classList.remove("hidden"),l.classList.remove("hidden"),s.classList.remove("hidden"),i.classList.remove("hidden"),m.textContent=g,u.textContent=p,E()):(t.className="status disconnected",o.textContent="üî¥ Disconnected",n.classList.remove("hidden"),r.classList.remove("hidden"),c.classList.add("hidden"),l.classList.add("hidden"),s.classList.add("hidden"),i.classList.add("hidden"),d.classList.add("hidden"),f.srcObject=null,v.srcObject=null)}())})}async function E(){if(e.isConnected&&e.roomId)try{console.log("[Popup] Fetching stats from server...");const t=await fetch("http://watch.toper.dev/status");if(!t.ok)return void console.error("[Popup] Failed to fetch server status:",t.status,t.statusText);const o=await t.json();console.log("[Popup] Server status received:",o),console.log("[Popup] Looking for room:",e.roomId);const n=o.rooms?.find(t=>t.roomId===e.roomId);if(!n)return console.log("[Popup] Room not found on server. Available rooms:",o.rooms?.map(e=>e.roomId)),void(p&&(p.textContent="Not Found",p.style.color="#ef4444"));console.log("[Popup] Room found:",n),console.log("[Popup] Room currentTime:",n.currentTime,"isPlaying:",n.isPlaying),console.log("[Popup] Room users:",n.users);const s=e=>{if(console.log("[Popup] Formatting time:",e,"type:",typeof e),null==e)return console.log("[Popup] Time is null/undefined, returning --:--"),"--:--";const t=Math.floor(e),o=`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`;return console.log("[Popup] Formatted time:",o),o};if(g){const e=s(n.currentTime);console.log("[Popup] Setting localTimeEl.textContent to:",e),g.textContent=e}else console.log("[Popup] localTimeEl not found!");if(p){const e=n.isPlaying?"Playing":"Paused";console.log("[Popup] Setting sync status to:",e),p.textContent=e,p.style.color=n.isPlaying?"#4ade80":"#fbbf24"}else console.log("[Popup] syncStatusEl not found!");if(y){const e=n.users||[];if(0===e.length)y.innerHTML='<div style="color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;">No users in party</div>';else{const t=e.map((e,t)=>{const o=Math.abs(e.currentTime-n.currentTime),i=o>2,d=e.isPlaying?"#4ade80":"#fbbf24",r=i?"#ef4444":"#4ade80";return`\n            <div style="padding: 8px; border-top: 1px solid rgba(255,255,255,0.1); ${0===t?"border-top: none;":""}">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">\n                <div style="font-weight: 600; font-size: 12px; color: rgba(255,255,255,0.9);">\n                  ${e.userId.substring(0,8)}...\n                </div>\n                <div style="font-size: 10px; color: ${d};">\n                  ${e.isPlaying?"‚ñ∂":"‚è∏"}\n                </div>\n              </div>\n              <div style="display: flex; justify-content: space-between; align-items: center;">\n                <div style="font-size: 13px; font-weight: 600; color: #a78bfa;">\n                  ${s(e.currentTime)}\n                </div>\n                <div style="font-size: 10px; color: ${r}; font-weight: 600;">\n                  ${i?`¬±${o.toFixed(1)}s`:"‚úì synced"}\n                </div>\n              </div>\n            </div>\n          `}).join("");y.innerHTML=`\n          <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);">\n            ${e.length} user${1===e.length?"":"s"} in party\n          </div>\n          ${t}\n        `}}}catch(e){console.error("[Popup] Error fetching stats:",e)}else console.log("[Popup] Not connected or no room ID",{isConnected:e.isConnected,roomId:e.roomId})}h(),r.addEventListener("click",async function(){const e=a.value.trim()||void 0;r.disabled=!0,o.textContent="‚è≥ Connecting...",chrome.runtime.sendMessage({type:"START_PARTY",roomId:e},e=>{e.success?setTimeout(h,500):(alert("Error: "+e.error),o.textContent="üî¥ Disconnected",r.disabled=!1)})}),c.addEventListener("click",function(){chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{a.value="",h()})}),l.addEventListener("click",function(){const t=a.value.trim()||e.roomId||void 0;l.disabled=!0,o.textContent="‚ôªÔ∏è Resetting...",chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{chrome.runtime.sendMessage({type:"START_PARTY",roomId:t},e=>{l.disabled=!1,e&&e.success?setTimeout(h,500):(alert("Error resetting party: "+(e&&e.error?e.error:"Unknown error")),o.textContent="üî¥ Disconnected")})})}),I.addEventListener("click",function(){e.roomId&&(navigator.clipboard.writeText(e.roomId),I.textContent="‚úì",setTimeout(()=>{I.textContent="üìã"},2e3))}),h(),setInterval(h,2e3),setInterval(()=>{e.isConnected&&E()},1e3),chrome.runtime.onMessage.addListener(e=>{"REMOTE_STREAM_RECEIVED"===e.type&&(v.srcObject=e.stream)})})();
//# sourceMappingURL=popup.js.map