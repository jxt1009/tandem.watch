(()=>{"use strict";class e{constructor(){this.suppressLocalUntil=0}set(e){this.suppressLocalUntil=Date.now()+e}isActive(){return Date.now()<this.suppressLocalUntil}}class t{constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}}function n(e,t,n){const o=e.getSenders().find(e=>e.track&&e.track.kind===t.kind);if(o)o.replaceTrack(t).catch(e=>console.warn("[WebRTCManager] Error replacing track",e));else try{e.addTrack(t,n)}catch(e){}}console.log("[Content Script] Initializing managers...");const o=new class{constructor(){this.partyActive=!1,this.userId=null,this.roomId=null,this.restoringPartyState=!1}startParty(e,t){this.partyActive=!0,this.userId=e,this.roomId=t}stopParty(){this.partyActive=!1,this.userId=null,this.roomId=null}isActive(){return this.partyActive}getUserId(){return this.userId}getRoomId(){return this.roomId}getState(){return{partyActive:this.partyActive,userId:this.userId,roomId:this.roomId,restoringPartyState:this.restoringPartyState}}isInParty(){return!!(this.partyActive&&this.userId&&this.roomId)}setRestoringFlag(e){this.restoringPartyState=e}isExtensionContextValid(){try{return chrome.runtime&&chrome.runtime.id}catch{return!1}}safeSendMessage(e,t){if(this.isExtensionContextValid())try{chrome.runtime.sendMessage(e,t)}catch(e){console.warn("Failed to send message:",e.message)}}},a=new class{constructor(){this.localPreviewVideo=null,this.remoteVideos=new Map,this.remoteStreams=new Map,this.streamMonitorInterval=null}getRemoteVideos(){return this.remoteVideos}getRemoteStreams(){return this.remoteStreams}setLocalPreviewVideo(e){this.localPreviewVideo=e}getLocalPreviewVideo(){return this.localPreviewVideo}setStreamMonitorInterval(e){this.streamMonitorInterval=e}getStreamMonitorInterval(){return this.streamMonitorInterval}clearStreamMonitorInterval(){this.streamMonitorInterval&&(clearInterval(this.streamMonitorInterval),this.streamMonitorInterval=null)}attachLocalPreview(e){console.log("[UIManager] Attaching local preview with stream:",e),this.removeLocalPreview();const t=document.createElement("video");t.id="toperparty-local-preview",t.autoplay=!0,t.muted=!0,t.playsInline=!0,t.style.position="fixed",t.style.bottom="20px",t.style.left="20px",t.style.width="240px",t.style.height="160px",t.style.zIndex="10001",t.style.border="2px solid #e50914",t.style.borderRadius="4px",t.style.transform="scaleX(-1)";try{t.srcObject=e,console.log("[UIManager] Set srcObject on local preview")}catch(n){console.warn("[UIManager] srcObject failed, trying createObjectURL:",n),t.src=URL.createObjectURL(e)}document.body.appendChild(t),this.localPreviewVideo=t,console.log("[UIManager] Local preview video appended to body"),t.play().catch(e=>{console.warn("[UIManager] Local preview play() failed:",e)})}removeLocalPreview(){if(this.localPreviewVideo){console.log("[UIManager] Removing local preview video");try{this.localPreviewVideo.srcObject&&(this.localPreviewVideo.srcObject=null)}catch(e){console.warn("[UIManager] Error clearing srcObject:",e)}this.localPreviewVideo.remove(),this.localPreviewVideo=null}}clearAll(){this.removeLocalPreview(),this.remoteVideos.clear(),this.remoteStreams.clear(),this.clearStreamMonitorInterval()}},r=new class{constructor(){this.injectAPIBridge()}injectAPIBridge(){const e=document.createElement("script");e.src=chrome.runtime.getURL("netflix-api-bridge.js"),(document.head||document.documentElement).appendChild(e),e.onload=function(){e.remove()}}_sendCommand(e,t=[]){return new Promise(function(n){const o=function(t){t.detail.command===e&&(document.removeEventListener("__toperparty_response",o),n(t.detail.result))};document.addEventListener("__toperparty_response",o),setTimeout(function(){n(null)},1e3),document.dispatchEvent(new CustomEvent("__toperparty_command",{detail:{command:e,args:t}}))})}play(){return this._sendCommand("play")}pause(){return this._sendCommand("pause")}seek(e){return this._sendCommand("seek",[e])}getCurrentTime(){return this._sendCommand("getCurrentTime")}isPaused(){return this._sendCommand("isPaused")}getVideoElement(){return document.querySelector("video")}},s=new class{constructor(n,o){this.state=n,this.netflix=o,this.lock=new e,this.isInitializedRef=new t(!1),this.listeners=null,this.remote=function({state:e,netflix:t,lock:n,isInitializedRef:o}){async function a(e,t,o){n.set(t);try{await o()}catch(t){console.error(`[SyncManager] Error applying remote ${e}:`,t)}}return{async handleRequestSync(n){if(o.get())try{const o=await t.getCurrentTime(),a=await t.isPaused();if(null==o)return void console.log("[SyncManager] Invalid playback state, ignoring sync request");const r=o/1e3;console.log("[SyncManager] Sending SYNC_RESPONSE to",n,"at",r.toFixed(2)+"s",a?"paused":"playing"),e.safeSendMessage({type:"SYNC_RESPONSE",targetUserId:n,currentTime:r,isPlaying:!a})}catch(e){console.error("[SyncManager] Error handling sync request:",e)}else console.log("[SyncManager] Not yet initialized, ignoring sync request")},async handleSyncResponse(e,n,r){o.get()?console.log("[SyncManager] Already initialized, ignoring late SYNC_RESPONSE"):null==e||"number"!=typeof e||e<0?console.warn("[SyncManager] Invalid SYNC_RESPONSE - bad currentTime:",e):(console.log("[SyncManager] Initial sync from",r,"seeking to",e.toFixed(2)+"s",n?"playing":"paused"),o.set(!0),await a("initial-sync",1500,async()=>{await t.seek(1e3*e);const o=await t.isPaused();n&&o?await t.play():n||o||await t.pause()}))},async handlePlaybackControl(e,n){console.log("[SyncManager] Remote",e.toUpperCase(),"from",n),await a(e,800,async()=>{"play"===e?await t.play():await t.pause()})},async handleSeek(e,n,o){console.log("[SyncManager] Remote SEEK to",e.toFixed(2)+"s",n?"playing":"paused","from",o),await a("seek",1200,async()=>{await t.seek(1e3*e);const o=await t.isPaused();n&&o?await t.play():n||o||await t.pause()})}}}({state:this.state,netflix:this.netflix,lock:this.lock,isInitializedRef:this.isInitializedRef})}async setup(){try{const e=await this.waitForVideo();if(!e)return void console.warn("[SyncManager] Netflix video element not found");console.log("[SyncManager] Setting up event listeners"),this.isInitializedRef.set(!1),this.state.safeSendMessage({type:"REQUEST_SYNC"}),setTimeout(()=>{this.isInitializedRef.get()||(console.log("[SyncManager] No sync response received, marking as initialized"),this.isInitializedRef.set(!0))},2e3);const t=function({video:e,state:t,isInitializedRef:n,lock:o,onPlay:a,onPause:r,onSeek:s}){const i=()=>{t.isActive()&&n.get()&&(o.isActive()||(console.log("[EventListeners] Play event detected"),a(e)))},c=()=>{t.isActive()&&n.get()&&(o.isActive()||(console.log("[EventListeners] Pause event detected"),r(e)))},l=()=>{t.isActive()&&n.get()&&(o.isActive()||(console.log("[EventListeners] Seek event detected"),s(e)))};return e.addEventListener("play",i),e.addEventListener("pause",c),e.addEventListener("seeked",l),{video:e,handlePlay:i,handlePause:c,handleSeeked:l}}({video:e,state:this.state,isInitializedRef:this.isInitializedRef,lock:this.lock,onPlay:e=>this.broadcastPlay(e),onPause:e=>this.broadcastPause(e),onSeek:e=>this.broadcastSeek(e)});this.listeners=t}catch(e){console.error("[SyncManager] Error setting up playback sync:",e)}}teardown(){if(this.listeners&&this.listeners.video){const{video:e,handlePlay:t,handlePause:n,handleSeeked:o}=this.listeners;try{e.removeEventListener("play",t),e.removeEventListener("pause",n),e.removeEventListener("seeked",o)}catch(e){console.warn("[SyncManager] Error removing listeners:",e)}this.listeners=null}}waitForVideo(){return new Promise((e,t)=>{const n=setTimeout(()=>t(new Error("Video element timeout")),1e4),o=()=>{const t=this.netflix.getVideoElement();t?(clearTimeout(n),e(t)):setTimeout(o,100)};o()})}broadcastPlay(e){console.log("[SyncManager] Broadcasting PLAY event"),this.state.safeSendMessage({type:"PLAY_PAUSE",control:"play",currentTime:e.currentTime})}broadcastPause(e){console.log("[SyncManager] Broadcasting PAUSE event"),this.state.safeSendMessage({type:"PLAY_PAUSE",control:"pause",currentTime:e.currentTime})}broadcastSeek(e){console.log("[SyncManager] Broadcasting SEEK event at",e.currentTime),this.state.safeSendMessage({type:"SEEK",currentTime:e.currentTime,isPlaying:!e.paused})}handleRequestSync(e){return this.remote.handleRequestSync(e)}handleSyncResponse(e,t,n){return this.remote.handleSyncResponse(e,t,n)}handlePlaybackControl(e,t){return this.remote.handlePlaybackControl(e,t)}handleSeek(e,t,n){return this.remote.handleSeek(e,t,n)}}(o,r),i=new class{constructor(e,t){this.stateManager=e,this.uiManager=t,this.peerConnections=new Map,this.remoteStreams=this.uiManager.getRemoteStreams(),this.remoteVideos=this.uiManager.getRemoteVideos(),this.peersThatLeft=new Set,this.localStream=null;const o=function(e){function t(t){console.log("[RemoteVideoManager] Removing remote video for peer:",t);const n=e.get(t);if(n){try{n.srcObject&&(n.srcObject=null)}catch(e){}n.remove(),e.delete(t)}}return{add:function(n,o){console.log("[RemoteVideoManager] Adding remote video for peer:",n,"stream:",o,"tracks:",o.getTracks()),t(n);const a=document.createElement("video");a.id="toperparty-remote-"+n,a.autoplay=!0,a.playsInline=!0,a.muted=!0,a.style.position="fixed",a.style.bottom="20px",a.style.right=20+180*e.size+"px",a.style.width="240px",a.style.height="160px",a.style.zIndex=10001,a.style.border="2px solid #00aaff",a.style.borderRadius="4px",console.log("[RemoteVideoManager] Created video element:",a.id,"at position:",a.style.right);try{a.srcObject=o,console.log("[RemoteVideoManager] Set srcObject successfully")}catch(e){console.warn("[RemoteVideoManager] srcObject failed, trying createObjectURL:",e),a.src=URL.createObjectURL(o)}document.body.appendChild(a),console.log("[RemoteVideoManager] Appended video to body"),e.set(n,a);try{a.play().then(()=>{console.log("[RemoteVideoManager] Video playing, unmuting"),a.muted=!1,a.volume=1}).catch(e=>{console.warn("[RemoteVideoManager] Play failed:",e),a.muted=!1})}catch(e){console.warn("[RemoteVideoManager] Error calling play:",e)}},remove:t}}(this.remoteVideos),a={},r=function({stateManager:e,sendSignal:t,remoteStreams:n,remoteVideos:o,addRemoteVideo:a,attemptReconnection:r,clearReconnection:s,removeRemoteVideo:i,peersThatLeft:c}){return function(l){const d=e.getState(),g=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun1.l.google.com:19302"]}]});return g.onicecandidate=e=>{e.candidate&&(console.log("[PeerConnection] ICE candidate for peer:",l,e.candidate),t({type:"ICE_CANDIDATE",from:d.userId,to:l,candidate:e.candidate}))},g.ontrack=e=>{console.log("[PeerConnection] ontrack fired for peer:",l,"track:",e.track,"streams:",e.streams);let t=e.streams&&e.streams[0]||n.get(l);if(t||(console.log("[PeerConnection] Creating new MediaStream for peer:",l),t=new MediaStream,n.set(l,t)),e.track){console.log("[PeerConnection] Adding track to stream:",e.track.kind,e.track.id);try{t.addTrack(e.track)}catch(e){console.warn("[PeerConnection] Error adding track:",e)}}o.has(l)||(console.log("[PeerConnection] Adding remote video for peer:",l,"stream tracks:",t.getTracks().length),a(l,t))},g.onconnectionstatechange=()=>{console.log("[PeerConnection] Connection state changed for peer:",l,"â†’",g.connectionState),"connected"===g.connectionState?s(l):"disconnected"===g.connectionState||"failed"===g.connectionState?c.has(l)?(i(l),s(l)):(i(l),r(l)):"closed"===g.connectionState&&(i(l),s(l))},g}}({stateManager:this.stateManager,sendSignal:e=>this._sendSignal(e),remoteStreams:this.remoteStreams,remoteVideos:this.remoteVideos,addRemoteVideo:o.add,attemptReconnection:e=>a.attempt(e),clearReconnection:e=>a.clear(e),removeRemoteVideo:e=>{o.remove(e),this.remoteStreams.delete(e)},peersThatLeft:this.peersThatLeft});Object.assign(a,function({stateManager:e,peerConnections:t,peersThatLeft:n,localStream:o,createPeer:a,sendSignal:r,addOrReplaceTrack:s}){const i=new Map,c=new Map;function l(e){i.delete(e);const t=c.get(e);t&&(clearTimeout(t),c.delete(e))}return{attempt:async function d(g){if(!e.isInParty())return;if(n.has(g))return void l(g);const m=i.get(g)||0,h=Math.min(1e3*Math.pow(2,m),3e4);if(m>=5)return void l(g);i.set(g,m+1);const u=c.get(g);u&&clearTimeout(u);const p=setTimeout(async()=>{const n=t.get(g);if(n){try{n.close()}catch(e){}t.delete(g)}try{const n=a(g);t.set(g,n);const i="function"==typeof o?o():o;i&&i.getTracks().forEach(e=>s(n,e,i));const c=await n.createOffer();await n.setLocalDescription(c);const l=e.getState();r({type:"OFFER",from:l.userId,to:g,offer:n.localDescription})}catch(e){console.error("[WebRTCManager] Reconnection failed:",e),d(g)}},h);c.set(g,p)},clear:l}}({stateManager:this.stateManager,peerConnections:this.peerConnections,peersThatLeft:this.peersThatLeft,localStream:()=>this.localStream,createPeer:r,sendSignal:e=>this._sendSignal(e),addOrReplaceTrack:n})),this.reconnectionManager=a,this.createPeer=r,this.videoManager=o,this.signalingHandlers=function({getState:e,peerConnections:t,peersThatLeft:n,getLocalStream:o,createPeer:a,sendSignal:r,addOrReplaceTrack:s,clearReconnection:i,removeRemoteVideo:c}){return{async handleJoin(i){console.log("[Signaling] Handling JOIN from",i);const c=e();if(i!==c.userId)if(n.delete(i),t.has(i))console.log("[Signaling] Already have peer connection for",i);else try{console.log("[Signaling] Creating peer connection for",i);const e=a(i);t.set(i,e);const n=o();console.log("[Signaling] Local stream:",n,"tracks:",n?n.getTracks().length:0),n?n.getTracks().forEach(t=>{console.log("[Signaling] Adding local track to peer:",t.kind,t.id),s(e,t,n)}):console.warn("[Signaling] No local stream available when handling JOIN"),console.log("[Signaling] Creating and sending OFFER to",i);const l=await e.createOffer();await e.setLocalDescription(l),r({type:"OFFER",from:c.userId,to:i,offer:e.localDescription})}catch(e){console.error("[Signaling] Error handling JOIN:",e),t.delete(i)}else console.log("[Signaling] Ignoring JOIN from self")},async handleOffer(n,i){console.log("[Signaling] Handling OFFER from",n);const c=e();if(n===c.userId)return void console.log("[Signaling] Ignoring OFFER from self");let l=t.get(n);if(l&&"closed"!==l.signalingState){console.log("[Signaling] Closing existing peer connection");try{l.close()}catch(e){}t.delete(n),l=null}l||(console.log("[Signaling] Creating new peer connection for",n),l=a(n),t.set(n,l));try{console.log("[Signaling] Setting remote description"),await l.setRemoteDescription(new RTCSessionDescription(i));const e=o();console.log("[Signaling] Local stream:",e,"tracks:",e?e.getTracks().length:0),e?e.getTracks().forEach(t=>{console.log("[Signaling] Adding local track to peer:",t.kind,t.id),s(l,t,e)}):console.warn("[Signaling] No local stream available when handling OFFER"),console.log("[Signaling] Creating and sending ANSWER to",n);const t=await l.createAnswer();await l.setLocalDescription(t),r({type:"ANSWER",from:c.userId,to:n,answer:l.localDescription})}catch(e){console.error("[Signaling] Error handling offer:",e),t.delete(n);try{l.close()}catch(e){}}},async handleAnswer(e,n){console.log("[Signaling] Handling ANSWER from",e);const o=t.get(e);if(o&&"have-local-offer"===o.signalingState){console.log("[Signaling] Setting remote description from ANSWER");try{await o.setRemoteDescription(new RTCSessionDescription(n)),console.log("[Signaling] Remote description set successfully")}catch(e){console.error("[Signaling] Error handling answer:",e)}}else console.warn("[Signaling] Cannot handle ANSWER - pc:",!!o,"signalingState:",o?.signalingState)},async handleIceCandidate(e,n){console.log("[Signaling] Handling ICE_CANDIDATE from",e);const o=t.get(e);if(o)try{await o.addIceCandidate(new RTCIceCandidate(n)),console.log("[Signaling] ICE candidate added successfully")}catch(e){console.warn("[Signaling] Error adding ICE candidate",e)}else console.warn("[Signaling] No peer connection found for ICE candidate from",e)},handleLeave(e){console.log("[Signaling] Handling LEAVE from",e),n.add(e);const o=t.get(e);if(o){try{o.close()}catch(e){}t.delete(e)}i(e),c(e)}}}({getState:()=>this.stateManager.getState(),peerConnections:this.peerConnections,peersThatLeft:this.peersThatLeft,getLocalStream:()=>this.localStream,createPeer:r,sendSignal:e=>this._sendSignal(e),addOrReplaceTrack:n,clearReconnection:a.clear,removeRemoteVideo:e=>{o.remove(e),this.remoteStreams.delete(e)}})}setLocalStream(e){this.localStream=e}getLocalStream(){return this.localStream}onLocalStreamAvailable(e){this.localStream=e,this.peerConnections.forEach(t=>{try{e.getTracks().forEach(o=>n(t,o,e))}catch(e){}})}async handleSignal(e){if(console.log("[WebRTCManager] handleSignal called with:",e),!e||!e.type)return void console.warn("[WebRTCManager] Invalid message:",e);const t=e.type,n=e.userId||e.from,o=e.to,a=this.stateManager.getState();console.log("[WebRTCManager] Processing signal type:",t,"from:",n,"to:",o,"myId:",a.userId),o&&o!==a.userId?console.log("[WebRTCManager] Ignoring message not meant for me"):"JOIN"===t&&n&&n!==a.userId?(console.log("[WebRTCManager] Dispatching to handleJoin"),await this.signalingHandlers.handleJoin(n)):"OFFER"===t&&e.offer&&n&&n!==a.userId?(console.log("[WebRTCManager] Dispatching to handleOffer"),await this.signalingHandlers.handleOffer(n,e.offer)):"ANSWER"===t&&e.answer&&n&&n!==a.userId?(console.log("[WebRTCManager] Dispatching to handleAnswer"),await this.signalingHandlers.handleAnswer(n,e.answer)):"ICE_CANDIDATE"===t&&e.candidate&&n&&n!==a.userId?(console.log("[WebRTCManager] Dispatching to handleIceCandidate"),await this.signalingHandlers.handleIceCandidate(n,e.candidate)):"LEAVE"===t&&n?(console.log("[WebRTCManager] Dispatching to handleLeave"),this.signalingHandlers.handleLeave(n)):console.log("[WebRTCManager] Signal not handled - type:",t,"from:",n,"conditions not met")}attemptReconnection(e){return this.reconnectionManager.attempt(e)}_sendSignal(e){this.stateManager.safeSendMessage({type:"SIGNAL_SEND",message:e},function(){})}clearAll(){this.peerConnections.forEach(e=>{try{e.close()}catch(e){}}),this.peerConnections.clear(),this.peersThatLeft.clear(),this.remoteVideos.forEach(e=>{try{e.srcObject&&(e.srcObject=null)}catch(e){}e.remove()}),this.remoteVideos.clear(),this.remoteStreams.clear(),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null)}}(o,a),c=new class{constructor(e){this.stateManager=e,this.urlMonitorInterval=null,this.lastUrl=null}start(){this.lastUrl=window.location.href}stop(){this.urlMonitorInterval&&(clearInterval(this.urlMonitorInterval),this.urlMonitorInterval=null)}saveState(){const e=this.stateManager.getState();if(!e.partyActive)return;const t=this.getRestorationState()||{},n={roomId:e.roomId,currentTime:t.currentTime||null,isPlaying:"boolean"==typeof t.isPlaying?t.isPlaying:null,timestamp:Date.now()};sessionStorage.setItem("toperparty_restore",JSON.stringify(n))}clearState(){sessionStorage.removeItem("toperparty_restore")}getRestorationState(){const e=sessionStorage.getItem("toperparty_restore");if(!e)return null;try{const t=JSON.parse(e);if(Date.now()-t.timestamp<3e4)return t}catch(e){console.error("[toperparty] Failed to parse restoration state:",e)}return null}}(o);console.log("[Content Script] Managers initialized");let l=null,d=null;!function(){const e=c.getRestorationState();e&&(c.clearState(),o.setRestoringFlag(!0),setTimeout(function(){chrome.runtime.sendMessage({type:"RESTORE_PARTY",roomId:e.roomId}),setTimeout(function(){o.setRestoringFlag(!1)},2e3)},1e3))}(),chrome.runtime.onMessage.addListener((e,t,n)=>{if(console.log("[Content Script] Received message:",e.type),"REQUEST_MEDIA_STREAM"===e.type)return console.log("[Content Script] Processing REQUEST_MEDIA_STREAM"),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(e=>{console.log("[Content Script] Media stream obtained, tracks:",e.getTracks().length),l=e,console.log("[Content Script] Setting local stream on WebRTC manager"),i.setLocalStream(e),i.onLocalStreamAvailable(e),console.log("[Content Script] Attaching local preview to UI"),a.attachLocalPreview(e),console.log("[Content Script] Local preview attached, sending success response"),n({success:!0})}).catch(e=>{console.error("[Content Script] Failed to get media stream:",e),n({success:!1,error:e.message})}),!0;"PARTY_STARTED"===e.type&&(console.log("[Content Script] Party started:",e.userId,e.roomId),o.startParty(e.userId,e.roomId),s.setup(),c.start(),d||(d=setInterval(()=>{o.getState().partyActive&&(l&&!document.getElementById("toperparty-local-preview")&&(console.log("[Content Script] Local preview missing, re-attaching"),a.attachLocalPreview(l)),a.getRemoteVideos(),a.getRemoteStreams().forEach((e,t)=>{const n="toperparty-remote-"+t;if(!document.getElementById(n)){console.log("[Content Script] Remote video missing for peer:",t,"re-adding");const n=i.videoManager;n&&n.add&&n.add(t,e)}}))},1e3),console.log("[Content Script] Started video element monitoring")),n({success:!0})),"PARTY_STOPPED"===e.type&&(console.log("[Content Script] Stopping party"),d&&(clearInterval(d),d=null,console.log("[Content Script] Stopped video element monitoring")),o.stopParty(),s.teardown(),c.stop(),c.clearState(),i.clearAll(),a.removeLocalPreview(),l&&(l.getTracks().forEach(e=>e.stop()),l=null),n({success:!0})),"SIGNAL"===e.type&&(console.log("[Content Script] Handling SIGNAL:",e.message?.type),i.handleSignal(e.message)),"APPLY_PLAYBACK_CONTROL"===e.type&&s.handlePlaybackControl(e.control,e.fromUserId),"APPLY_SEEK"===e.type&&s.handleSeek(e.currentTime,e.isPlaying,e.fromUserId),"APPLY_URL_CHANGE"===e.type&&(o.restoringPartyState||(window.location.href=e.url)),"HANDLE_REQUEST_SYNC"===e.type&&s.handleRequestSync(e.fromUserId),"APPLY_SYNC_RESPONSE"===e.type&&s.handleSyncResponse(e.currentTime,e.isPlaying,e.fromUserId)}),window.addEventListener("beforeunload",()=>{o.isActive()&&c.saveState()})})();
//# sourceMappingURL=content-script.js.map